(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[668],{2220:function(e,t,s){Promise.resolve().then(s.bind(s,2892))},2892:function(e,t,s){"use strict";s.d(t,{default:function(){return u}});var a=s(7437),l=s(2265),n=s(7648),i=s(8822),r=s(9116),d=s(1741);function c(e){let{value:t,max:s,label:l}=e,n=s>0?Math.min(100,Math.round(t/s*100)):0;return(0,a.jsxs)("div",{style:{display:"grid",gap:4},children:[(0,a.jsx)("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:l}),(0,a.jsx)("div",{style:{background:"#eee",height:8,borderRadius:4},children:(0,a.jsx)("div",{style:{width:"".concat(n,"%"),height:8,background:"var(--primary-500, #22a)",borderRadius:4}})}),(0,a.jsx)("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:t})]})}function o(){var e,t;let[s,d]=(0,l.useState)(null),[o,u]=(0,l.useState)(null),[m,p]=(0,l.useState)(null),[h,v]=(0,l.useState)(!1),[x,g]=(0,l.useState)(""),[j,y]=(0,l.useState)(""),[f,b]=(0,l.useState)("day"),S=async()=>{let e=(0,i.Z6)();if(e){v(!0),p(null);try{let[t,s]=await Promise.all([(0,r.S)("/admin/reports/summary",{authToken:e.accessToken,params:{period_start:x||void 0,period_end:j||void 0}}),(0,r.S)("/analytics/timeseries",{authToken:e.accessToken,params:{period_start:x||void 0,period_end:j||void 0,granularity:f}})]);d(t),u(s)}catch(e){p("Impossible de charger les analytics.")}finally{v(!1)}}};(0,l.useEffect)(()=>{S()},[]);let N=Math.max(0,...null!==(e=null==o?void 0:o.points.map(e=>e.orders))&&void 0!==e?e:[0]),_=Math.max(0,...null!==(t=null==o?void 0:o.points.map(e=>e.revenue_cents))&&void 0!==t?t:[0]);return(0,a.jsxs)("main",{className:"container",style:{display:"grid",gap:"var(--space-12)"},children:[(0,a.jsxs)("nav",{"aria-label":"Fil d'ariane",style:{fontSize:"var(--fs-small)"},children:[(0,a.jsx)(n.default,{className:"muted",href:"/",children:"Accueil"})," / Admin / Analytics"]}),(0,a.jsx)("section",{className:"section",children:(0,a.jsxs)("div",{style:{display:"grid",gap:"var(--space-3)"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"badge badge--impact",children:"Administration"}),(0,a.jsx)("h1",{style:{marginTop:"var(--space-2)"},children:"Analytics"}),(0,a.jsx)("p",{className:"muted",children:"Series temporelles, top produits et panier moyen."})]}),m?(0,a.jsx)("div",{className:"alert alert--warning",children:m}):null,(0,a.jsxs)("div",{className:"card",style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[(0,a.jsx)("input",{className:"input",type:"date",value:x,onChange:e=>g(e.target.value)}),(0,a.jsx)("input",{className:"input",type:"date",value:j,onChange:e=>y(e.target.value)}),(0,a.jsxs)("select",{className:"select",value:f,onChange:e=>b(e.target.value),children:[(0,a.jsx)("option",{value:"day",children:"Jour"}),(0,a.jsx)("option",{value:"week",children:"Semaine"}),(0,a.jsx)("option",{value:"month",children:"Mois"})]}),(0,a.jsx)("button",{className:"btn btn--primary",type:"button",onClick:S,children:"Actualiser"}),(0,a.jsxs)("div",{style:{marginLeft:"auto",display:"flex",gap:8,flexWrap:"wrap"},children:[(0,a.jsx)("button",{className:"btn btn--ghost",type:"button",onClick:()=>{let e=new Date,t=new Date(e);t.setDate(e.getDate()-30),g(t.toISOString().slice(0,10)),y(e.toISOString().slice(0,10)),b("day")},children:"30j"}),(0,a.jsx)("button",{className:"btn btn--ghost",type:"button",onClick:()=>{let e=new Date,t=new Date(e);t.setDate(e.getDate()-90),g(t.toISOString().slice(0,10)),y(e.toISOString().slice(0,10)),b("week")},children:"90j"}),(0,a.jsx)("button",{className:"btn btn--ghost",type:"button",onClick:()=>{let e=new Date;g(new Date(Date.UTC(e.getFullYear(),0,1)).toISOString().slice(0,10)),y(e.toISOString().slice(0,10)),b("month")},children:"YTD"}),(0,a.jsx)("button",{className:"btn btn--ghost",type:"button",onClick:()=>{let e=new Date,t=new Date(e);t.setFullYear(e.getFullYear()-1),g(t.toISOString().slice(0,10)),y(e.toISOString().slice(0,10)),b("month")},children:"12m"})]})]}),h?(0,a.jsx)("p",{className:"muted",children:"Chargement..."}):(0,a.jsxs)(a.Fragment,{children:[s?(0,a.jsxs)("div",{className:"card",style:{display:"grid",gap:8},children:[(0,a.jsx)("strong",{children:"Periode"}),(0,a.jsx)("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:"".concat(new Date(s.period_start).toLocaleDateString("fr-FR")," -> ").concat(new Date(s.period_end).toLocaleDateString("fr-FR"))}),(0,a.jsxs)("div",{style:{display:"grid",gap:4,gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))"},children:[(0,a.jsxs)("div",{children:["Total commandes: ",s.total_orders]}),(0,a.jsxs)("div",{children:["Revenu total (centimes): ",s.total_revenue_cents]}),(0,a.jsxs)("div",{children:["Articles vendus: ",s.total_items_sold]}),(0,a.jsxs)("div",{children:["Panier moyen (centimes): ",s.average_order_value_cents]})]})]}):null,o?(0,a.jsxs)("div",{className:"card",style:{display:"grid",gap:12},children:[(0,a.jsx)("strong",{children:"Series temporelles (jour)"}),(0,a.jsx)("div",{style:{display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))"},children:o.points.map(e=>(0,a.jsxs)("div",{className:"grid",style:{gap:8},children:[(0,a.jsx)("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:e.bucket}),(0,a.jsx)(c,{value:e.orders,max:N,label:"Commandes"}),(0,a.jsx)(c,{value:e.revenue_cents,max:_,label:"Revenu (c)"})]},e.bucket))})]}):null,s?(0,a.jsxs)("div",{className:"card",style:{display:"grid",gap:8},children:[(0,a.jsx)("strong",{children:"Top produits"}),0===s.top_products.length?(0,a.jsx)("p",{className:"muted",children:"Aucun produit."}):(0,a.jsx)("div",{className:"grid",style:{gap:8},children:s.top_products.map((e,t)=>{var s;return(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,a.jsx)("span",{children:e.product_title||"Produit #".concat(null!==(s=e.product_id)&&void 0!==s?s:"N/A")}),(0,a.jsxs)("span",{className:"muted",style:{fontSize:"var(--fs-small)"},children:[e.units," u. â€¢ ",e.revenue_cents," c"]})]},"".concat(e.product_id,"-").concat(t))})})]}):null]})]})})]})}function u(){return(0,a.jsx)(d.Z,{requireAuth:!0,requiredRole:"admin",children:()=>(0,a.jsx)(o,{})})}}},function(e){e.O(0,[972,697,741,971,117,744],function(){return e(e.s=2220)}),_N_E=e.O()}]);