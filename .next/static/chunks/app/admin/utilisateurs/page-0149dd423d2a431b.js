(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{8117:function(e,s,t){Promise.resolve().then(t.bind(t,2519))},2519:function(e,s,t){"use strict";t.d(s,{default:function(){return f}});var a=t(7437),i=t(2265),n=t(7648),l=t(8822),r=t(9116),c=t(1741),d=t(4730);async function u(e){var s,t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.S)("/admin/users",{authToken:e,params:{limit:null!==(s=a.limit)&&void 0!==s?s:50,offset:null!==(t=a.offset)&&void 0!==t?t:0}})}async function o(e,s,t){return(0,r.S)("/admin/users/".concat(s,"/role"),{method:"PATCH",authToken:e,body:JSON.stringify({role:t})})}async function h(e,s,t){return(0,r.S)("/admin/users/".concat(s,"/status"),{method:"PATCH",authToken:e,body:JSON.stringify({is_active:t})})}async function m(e,s){return(0,r.S)("/admin/users",{method:"POST",authToken:e,body:JSON.stringify(s)})}async function x(e,s){await (0,r.S)("/admin/users/".concat(s),{method:"DELETE",authToken:e})}function j(e){let{value:s,onChange:t}=e;return(0,a.jsxs)("select",{className:"select",value:s,onChange:e=>t(e.target.value),children:[(0,a.jsx)("option",{value:"consumer",children:"Consommateur"}),(0,a.jsx)("option",{value:"producer",children:"Producteur"}),(0,a.jsx)("option",{value:"admin",children:"Admin"})]})}function p(){let[e,s]=(0,i.useState)([]),[t,r]=(0,i.useState)(!1),[c,p]=(0,i.useState)(null),[f,v]=(0,i.useState)(""),[y,g]=(0,i.useState)(""),[b,N]=(0,i.useState)("consumer"),{user:C}=(0,d.a)();(0,i.useEffect)(()=>{let e=(0,l.Z6)();e&&(r(!0),p(null),u(e.accessToken).then(e=>s(e.items)).catch(()=>p("Impossible de charger les utilisateurs.")).finally(()=>r(!1)))},[]);let S=async(e,t)=>{try{let a=(0,l.Z6)();if(!a)return;let i=await o(a.accessToken,e,t);s(e=>e.map(e=>e.id===i.id?{...e,role:i.role}:e))}catch(e){}},_=async(e,t)=>{try{let a=(0,l.Z6)();if(!a)return;let i=await h(a.accessToken,e,t);s(e=>e.map(e=>e.id===i.id?{...e,is_active:i.is_active}:e))}catch(e){}},k=async e=>{e.preventDefault();let t=(0,l.Z6)();if(t){p(null);try{let e=await m(t.accessToken,{email:f,password:y,role:b});s(s=>[e,...s]),v(""),g(""),N("consumer")}catch(e){p("Cr\xe9ation impossible (email d\xe9j\xe0 utilis\xe9 ?)")}}},w=async e=>{let t=(0,l.Z6)();if(t)try{await x(t.accessToken,e),s(s=>s.filter(s=>s.id!==e))}catch(e){}},A=(0,i.useMemo)(()=>e.length,[e]);return(0,a.jsxs)("main",{className:"container",style:{display:"grid",gap:"var(--space-12)"},children:[(0,a.jsxs)("nav",{"aria-label":"Fil d'ariane",style:{fontSize:"var(--fs-small)"},children:[(0,a.jsx)(n.default,{className:"muted",href:"/",children:"Accueil"})," / Admin / Utilisateurs"]}),(0,a.jsx)("section",{className:"section",children:(0,a.jsxs)("div",{style:{display:"grid",gap:"var(--space-3)"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"badge badge--impact",children:"Administration"}),(0,a.jsx)("h1",{style:{marginTop:"var(--space-2)"},children:"Utilisateurs"}),(0,a.jsxs)("p",{className:"muted",children:["Cr\xe9ation, activation et gestion des r\xf4les (",A,")."]})]}),(0,a.jsxs)("div",{className:"card",style:{display:"grid",gap:8},children:[(0,a.jsx)("strong",{children:"Cr\xe9er un utilisateur"}),(0,a.jsxs)("form",{className:"grid",style:{gap:8,gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))"},onSubmit:k,children:[(0,a.jsxs)("label",{className:"input-label",children:["Email",(0,a.jsx)("input",{className:"input",type:"email",required:!0,value:f,onChange:e=>v(e.target.value)})]}),(0,a.jsxs)("label",{className:"input-label",children:["Mot de passe",(0,a.jsx)("input",{className:"input",type:"password",required:!0,value:y,onChange:e=>g(e.target.value)})]}),(0,a.jsxs)("label",{className:"input-label",children:["R\xf4le",(0,a.jsx)(j,{value:b,onChange:N})]}),(0,a.jsx)("div",{style:{alignSelf:"end"},children:(0,a.jsx)("button",{className:"btn btn--primary",type:"submit",children:"Cr\xe9er"})})]})]}),c?(0,a.jsx)("div",{className:"alert alert--warning",children:c}):null,t?(0,a.jsx)("p",{className:"muted",children:"Chargement..."}):0===e.length?(0,a.jsx)("p",{className:"muted",children:"Aucun utilisateur."}):(0,a.jsx)("div",{className:"card",style:{overflowX:"auto"},children:(0,a.jsxs)("table",{className:"table",style:{width:"100%",borderCollapse:"collapse"},children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"ID"}),(0,a.jsx)("th",{children:"Email"}),(0,a.jsx)("th",{children:"R\xf4le"}),(0,a.jsx)("th",{children:"Nom"}),(0,a.jsx)("th",{children:"R\xe9gion"}),(0,a.jsx)("th",{children:"Cr\xe9\xe9"}),(0,a.jsx)("th",{children:"Actif"}),(0,a.jsx)("th",{children:"Actions"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>{var s,t,i;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.id}),(0,a.jsx)("td",{children:e.email}),(0,a.jsx)("td",{children:(0,a.jsx)(j,{value:e.role,onChange:s=>S(e.id,s)})}),(0,a.jsx)("td",{children:e.first_name||e.last_name?"".concat(null!==(s=e.first_name)&&void 0!==s?s:""," ").concat(null!==(t=e.last_name)&&void 0!==t?t:"").trim():"—"}),(0,a.jsx)("td",{children:null!==(i=e.region)&&void 0!==i?i:"—"}),(0,a.jsx)("td",{children:new Date(e.created_at).toLocaleString("fr-FR")}),(0,a.jsx)("td",{children:(0,a.jsxs)("label",{className:"checkbox",children:[(0,a.jsx)("input",{type:"checkbox",checked:e.is_active,onChange:s=>_(e.id,s.target.checked),disabled:(null==C?void 0:C.id)===e.id}),(0,a.jsx)("span",{className:"muted",style:{fontSize:"var(--fs-small)"},children:e.is_active?"Actif":"Inactif"})]})}),(0,a.jsx)("td",{children:(0,a.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[(0,a.jsx)("button",{className:"btn btn--ghost",type:"button",onClick:()=>S(e.id,"consumer"===e.role?"producer":"consumer"),children:"Basculer C/P"}),(0,a.jsx)("button",{className:"btn btn--ghost",type:"button",onClick:()=>w(e.id),disabled:(null==C?void 0:C.id)===e.id,children:"Supprimer"})]})})]},e.id)})})]})})]})})]})}function f(){return(0,a.jsx)(c.Z,{requireAuth:!0,requiredRole:"admin",children:()=>(0,a.jsx)(p,{})})}}},function(e){e.O(0,[972,697,741,971,117,744],function(){return e(e.s=8117)}),_N_E=e.O()}]);