(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[282],{8375:function(e,t,a){Promise.resolve().then(a.bind(a,663))},663:function(e,t,a){"use strict";a.d(t,{default:function(){return f}});var s=a(7437),l=a(2265),n=a(7648),i=a(8822),r=a(4730),c=a(9116);async function d(e){return{items:(await (0,c.S)("/admin/public-data",{authToken:e})).items.map(e=>({dataset:e.dataset,path:e.path,exists:e.exists,sizeBytes:e.size_bytes,updatedAt:e.updated_at,count:e.count,sample:e.sample}))}}async function o(e,t,a){let s=new FormData;s.append("file",a);let l=await fetch(new URL("/api/v1/admin/public-data/".concat(encodeURIComponent(t),"/upload"),"http://localhost:8000"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)},body:s});if(!l.ok)throw Error("Upload failed");let n=await l.json();return{dataset:n.dataset,path:n.path,exists:n.exists,sizeBytes:n.size_bytes,updatedAt:n.updated_at,count:n.count,sample:n.sample}}var u=a(1741);let p={producers:"Producteurs locaux",consumption:"Habitudes de consommation",waste:"Gaspillage / acteurs anti-gaspi"};function m(e){var t;let{dataset:a,onUpload:l}=e,n=null!==(t=p[a.dataset])&&void 0!==t?t:a.dataset,i=a.updatedAt?new Date(1e3*a.updatedAt):null;return(0,s.jsxs)("div",{className:"card",style:{display:"grid",gap:8},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,flexWrap:"wrap"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:n}),(0,s.jsx)("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:a.dataset})]}),(0,s.jsx)("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:a.exists?(0,s.jsxs)(s.Fragment,{children:[a.count," entr\xe9es • ",function(e){if(!e)return"0 o";let t=["o","Ko","Mo","Go"],a=Math.min(t.length-1,Math.floor(Math.log(e)/Math.log(1024)));return"".concat((e/Math.pow(1024,a)).toFixed(1)," ").concat(t[a])}(a.sizeBytes)," • ",i?"MAJ ".concat(i.toLocaleDateString("fr-FR")):"date inconnue"]}):"Aucune donn\xe9e import\xe9e"}),(0,s.jsxs)("label",{className:"btn btn--ghost",style:{marginLeft:"auto"},children:["Importer un CSV",(0,s.jsx)("input",{type:"file",accept:".csv,text/csv",style:{display:"none"},onChange:async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&(await l(a),e.target.value="")}})]})]}),a.sample&&a.sample.length>0?(0,s.jsx)("div",{style:{overflowX:"auto"},children:(0,s.jsxs)("table",{className:"table",style:{minWidth:480},children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{children:Object.keys(a.sample[0]).slice(0,4).map(e=>(0,s.jsx)("th",{children:e},e))})}),(0,s.jsx)("tbody",{children:a.sample.map((e,t)=>(0,s.jsx)("tr",{children:Object.keys(a.sample[0]).slice(0,4).map(t=>{var a;return(0,s.jsx)("td",{children:String(null!==(a=e[t])&&void 0!==a?a:"")},t)})},t))})]})}):(0,s.jsx)("p",{className:"muted",style:{margin:0},children:"Pas encore d’\xe9chantillon pour ce jeu."}),"producers"===a.dataset?(0,s.jsxs)("div",{className:"alert alert--info",style:{margin:0},children:["Endpoint public disponible : ",(0,s.jsx)("code",{children:"/api/v1/public/producers"})," (utilisable c\xf4t\xe9 front pour cartes/filters)."]}):null]})}function h(){let[e,t]=(0,l.useState)([]),[a,c]=(0,l.useState)(null),[u,p]=(0,l.useState)(!1),{user:h}=(0,r.a)(),f=async()=>{let e=(0,i.Z6)();if(e){p(!0),c(null);try{let a=await d(e.accessToken);t(a.items)}catch(e){console.error(e),c("Impossible de charger les donn\xe9es publiques.")}finally{p(!1)}}};(0,l.useEffect)(()=>{f()},[]);let x=e=>async a=>{let s=(0,i.Z6)();if(s){p(!0),c(null);try{let l=await o(s.accessToken,e,a);t(t=>[...t.filter(t=>t.dataset!==e),l].sort((e,t)=>e.dataset.localeCompare(t.dataset)))}catch(e){console.error(e),c("Import impossible. V\xe9rifiez le CSV.")}finally{p(!1)}}},j=(0,l.useMemo)(()=>e.slice().sort((e,t)=>e.dataset.localeCompare(t.dataset)),[e]);return(0,s.jsxs)("main",{className:"container",style:{display:"grid",gap:"var(--space-12)"},children:[(0,s.jsxs)("nav",{"aria-label":"Fil d'ariane",style:{fontSize:"var(--fs-small)"},children:[(0,s.jsx)(n.default,{className:"muted",href:"/",children:"Accueil"})," / Admin / Donn\xe9es publiques"]}),(0,s.jsx)("section",{className:"section",children:(0,s.jsxs)("div",{className:"grid",style:{gap:"var(--space-3)"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"badge badge--impact",children:"Administration"}),(0,s.jsx)("h1",{style:{marginTop:"var(--space-2)"},children:"Donn\xe9es publiques"}),(0,s.jsx)("p",{className:"muted",children:"Import CSV, pr\xe9visualisation et publication d’API publiques pour les jeux producteurs/conso/gaspillage."})]}),a?(0,s.jsx)("div",{className:"alert alert--warning",children:a}):null,u?(0,s.jsx)("p",{className:"muted",children:"Chargement..."}):null,(0,s.jsx)("div",{className:"grid",style:{gap:"var(--space-3)"},children:j.map(e=>(0,s.jsx)(m,{dataset:e,onUpload:x(e.dataset)},e.dataset))}),(0,s.jsxs)("div",{className:"alert alert--info",children:["Tips : utilisez ces donn\xe9es pour alimenter les filtres r\xe9gion/“R\xe9seau de producteurs” sur le front. Endpoint public actuel : ",(0,s.jsx)("code",{children:"/api/v1/public/producers"}),"."]})]})})]})}function f(){return(0,s.jsx)(u.Z,{requireAuth:!0,requiredRole:"admin",children:()=>(0,s.jsx)(h,{})})}}},function(e){e.O(0,[972,697,741,971,117,744],function(){return e(e.s=8375)}),_N_E=e.O()}]);