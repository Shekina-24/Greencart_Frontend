(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[375],{9323:function(e,s,a){Promise.resolve().then(a.bind(a,8306))},8306:function(e,s,a){"use strict";a.d(s,{default:function(){return p}});var t=a(7437),r=a(2265),n=a(7648),l=a(4730),i=a(8822),c=a(9116),d=a(1741);function o(){let{user:e}=(0,l.a)(),[s,a]=(0,r.useState)(null),[d,o]=(0,r.useState)([]),[p,u]=(0,r.useState)(null),[m,h]=(0,r.useState)(!1),[v,x]=(0,r.useState)(""),[g,j]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=(0,i.Z6)();e&&(h(!0),u(null),Promise.all([(0,c.S)("/admin/reports/summary",{authToken:e.accessToken}),(0,c.S)("/admin/reports/files",{authToken:e.accessToken})]).then(e=>{let[s,t]=e;a(s),o(t.items)}).catch(e=>{console.error("[AdminReportsPage] Failed to load reports",e),u("Impossible de charger les rapports.")}).finally(()=>h(!1)))},[e]);let f=(0,c.r)(),y=async()=>{try{let e=(0,i.Z6)();if(!e)return;let s=new URLSearchParams;v&&s.set("period_start",v),g&&s.set("period_end",g),await (0,c.S)("/admin/reports/generate?".concat(s.toString()),{method:"POST",authToken:e.accessToken});let[t,r]=await Promise.all([(0,c.S)("/admin/reports/summary",{authToken:e.accessToken,params:{period_start:v||void 0,period_end:g||void 0}}),(0,c.S)("/admin/reports/files",{authToken:e.accessToken})]);a(t),o(r.items)}catch(e){u("Echec de la g\xe9n\xe9ration du rapport.")}};return(0,t.jsxs)("main",{className:"container",style:{display:"grid",gap:"var(--space-12)"},children:[(0,t.jsxs)("nav",{"aria-label":"Fil d'ariane",style:{fontSize:"var(--fs-small)"},children:[(0,t.jsx)(n.default,{className:"muted",href:"/",children:"Accueil"})," / Admin / Rapports"]}),(0,t.jsx)("section",{className:"section",children:(0,t.jsxs)("div",{style:{display:"grid",gap:"var(--space-3)"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"badge badge--impact",children:"Administration"}),(0,t.jsx)("h1",{style:{marginTop:"var(--space-2)"},children:"Rapports"}),(0,t.jsx)("p",{className:"muted",children:"Consultez le r\xe9sum\xe9 des ventes et t\xe9l\xe9chargez les rapports g\xe9n\xe9r\xe9s."})]}),p?(0,t.jsx)("div",{className:"alert alert--warning",children:p}):null,m?(0,t.jsx)("p",{className:"muted",children:"Chargement..."}):(0,t.jsxs)(t.Fragment,{children:[s?(0,t.jsxs)("div",{className:"card",style:{gap:"var(--space-2)"},children:[(0,t.jsx)("strong",{children:"P\xe9riode"}),(0,t.jsxs)("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:[new Date(s.period_start).toLocaleDateString("fr-FR")," â†’ ",new Date(s.period_end).toLocaleDateString("fr-FR")]}),(0,t.jsxs)("div",{style:{display:"grid",gap:"var(--space-1)"},children:[(0,t.jsxs)("div",{children:["Total commandes: ",s.total_orders]}),(0,t.jsxs)("div",{children:["Revenu total (centimes): ",s.total_revenue_cents]}),(0,t.jsxs)("div",{children:["Articles vendus: ",s.total_items_sold]}),(0,t.jsxs)("div",{children:["Panier moyen (centimes): ",s.average_order_value_cents]})]}),(0,t.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",alignItems:"center",marginTop:"8px"},children:[(0,t.jsx)("input",{className:"input",type:"date",value:v,onChange:e=>x(e.target.value)}),(0,t.jsx)("input",{className:"input",type:"date",value:g,onChange:e=>j(e.target.value)}),(0,t.jsx)("button",{className:"btn btn--primary",type:"button",onClick:y,children:"G\xe9n\xe9rer & actualiser"})]})]}):null,(0,t.jsxs)("div",{className:"card",style:{gap:"var(--space-2)"},children:[(0,t.jsx)("strong",{children:"Fichiers disponibles"}),0===d.length?(0,t.jsx)("p",{className:"muted",children:"Aucun rapport g\xe9n\xe9r\xe9 pour le moment."}):(0,t.jsx)("div",{className:"grid",style:{gap:"var(--space-2)"},children:d.map(e=>{var s;return(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:"var(--space-2)"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{children:e.name}),(0,t.jsxs)("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:[e.format.toUpperCase()," \xb7 ",(s=e.size_bytes)<1024?"".concat(s," B"):s<1048576?"".concat((s/1024).toFixed(1)," KB"):"".concat((s/1048576).toFixed(1)," MB")]})]}),(0,t.jsx)("a",{className:"btn btn--ghost",href:"".concat(f).concat(e.url),target:"_blank",rel:"noreferrer",children:"T\xe9l\xe9charger"})]},e.name)})})]})]})]})})]})}function p(){return(0,t.jsx)(d.Z,{requireAuth:!0,requiredRole:"admin",children:()=>(0,t.jsx)(o,{})})}}},function(e){e.O(0,[972,697,741,971,117,744],function(){return e(e.s=9323)}),_N_E=e.O()}]);