(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[962],{2813:function(e,t,a){Promise.resolve().then(a.bind(a,1196))},1196:function(e,t,a){"use strict";a.d(t,{default:function(){return o}});var r=a(7437),n=a(1741),l=a(2265),i=a(8822),s=a(9116);async function d(e,t){let a={region:t.region||void 0,producer_id:t.producerId,date_start:t.dateStart||void 0,date_end:t.dateEnd||void 0},r=await (0,s.S)("/analytics/embed-token",{method:"POST",authToken:e,body:JSON.stringify(a)});return{embedUrl:r.embed_url,token:r.token,expiresAt:r.expires_at}}function u(e){var t,a,n,s;let{title:u="Tableau de bord Power BI"}=e,[o,c]=(0,l.useState)({}),[m,h]=(0,l.useState)(null),[p,g]=(0,l.useState)(null),[v,x]=(0,l.useState)(!1),b=(0,l.useMemo)(()=>(function(e){if(!e)return null;try{let t=new URL(e.embedUrl);return e.token&&t.searchParams.set("access_token",e.token),t.toString()}catch(t){return e.embedUrl}})(m),[m]),f=async()=>{let e=(0,i.Z6)();if(!e){g("Authentification requise.");return}x(!0),g(null);try{let t=await d(e.accessToken,o);h(t)}catch(e){console.error("[AdminAnalyticsEmbed] Failed to fetch embed token",e),g("Impossible de r\xe9cup\xe9rer le tableau de bord externe."),h(null)}finally{x(!1)}};return(0,r.jsx)("section",{className:"section",children:(0,r.jsxs)("div",{className:"grid",style:{gap:"var(--space-4)"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"badge badge--impact",children:"BI externe"}),(0,r.jsx)("h2",{style:{marginTop:"var(--space-1)"},children:u}),(0,r.jsx)("p",{className:"muted",style:{margin:0},children:"Tableau de bord Power BI avec filtres r\xe9gion / producteur / p\xe9riode."})]}),(0,r.jsxs)("div",{className:"card",style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[(0,r.jsx)("input",{className:"input",placeholder:"R\xe9gion (optionnel)",value:null!==(t=o.region)&&void 0!==t?t:"",style:{flex:"1 1 180px",minWidth:160},onChange:e=>c(t=>({...t,region:e.target.value||void 0}))}),(0,r.jsx)("input",{className:"input",type:"number",placeholder:"Producteur ID",value:null!==(a=o.producerId)&&void 0!==a?a:"",style:{flex:"1 1 150px",minWidth:140},onChange:e=>c(t=>({...t,producerId:e.target.value?Number(e.target.value):void 0}))}),(0,r.jsx)("input",{className:"input",type:"date",value:null!==(n=o.dateStart)&&void 0!==n?n:"",style:{flex:"1 1 150px",minWidth:140},onChange:e=>c(t=>({...t,dateStart:e.target.value||void 0}))}),(0,r.jsx)("input",{className:"input",type:"date",value:null!==(s=o.dateEnd)&&void 0!==s?s:"",style:{flex:"1 1 150px",minWidth:140},onChange:e=>c(t=>({...t,dateEnd:e.target.value||void 0}))}),(0,r.jsx)("button",{className:"btn btn--primary",type:"button",onClick:f,disabled:v,children:v?"Chargement...":"Charger le tableau"}),m?(0,r.jsxs)("div",{className:"muted",style:{marginLeft:"auto",fontSize:"var(--fs-small)"},children:["Expire le ",new Date(m.expiresAt).toLocaleString("fr-FR")]}):null]}),p?(0,r.jsx)("div",{className:"alert alert--warning",children:p}):null,(0,r.jsx)("div",{className:"card",style:{minHeight:360,height:"60vh",display:"grid"},children:b?(0,r.jsx)("iframe",{title:"Power BI dashboard",src:b,style:{width:"100%",height:"100%",minHeight:360,border:"none"},allowFullScreen:!0}):(0,r.jsx)("p",{className:"muted",style:{margin:0},children:v?"Chargement du tableau...":"Cliquez sur Charger pour afficher le tableau Power BI."})})]})})}function o(){return(0,r.jsx)(n.Z,{requireAuth:!0,requiredRole:"admin",children:()=>(0,r.jsx)(u,{title:"Tableau Power BI"})})}}},function(e){e.O(0,[972,697,741,971,117,744],function(){return e(e.s=2813)}),_N_E=e.O()}]);