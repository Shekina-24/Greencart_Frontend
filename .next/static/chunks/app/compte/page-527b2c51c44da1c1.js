(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[560],{2659:function(e,s,a){Promise.resolve().then(a.bind(a,7908))},7908:function(e,s,a){"use strict";a.d(s,{default:function(){return m}});var t=a(7437),n=a(2265),l=a(8822),i=a(9116);async function r(e,s){var a;let t={};return void 0!==s.firstName&&(t.first_name=s.firstName),void 0!==s.lastName&&(t.last_name=s.lastName),void 0!==s.region&&(t.region=s.region),void 0!==s.consentNewsletter&&(t.consent_newsletter=s.consentNewsletter),void 0!==s.consentAnalytics&&(t.consent_analytics=s.consentAnalytics),{id:(a=await (0,i.S)("/users/me",{method:"PATCH",authToken:e,body:JSON.stringify(t)})).id,email:a.email,role:a.role,firstName:a.first_name,lastName:a.last_name,region:a.region,isActive:a.is_active,emailVerifiedAt:a.email_verified_at,lastLoginAt:a.last_login_at,consentNewsletter:a.consent_newsletter,consentAnalytics:a.consent_analytics,createdAt:a.created_at,updatedAt:a.updated_at}}var c=a(4730),o=a(1741);function d(e){var s,a,i;let{user:o}=e,{reloadUser:d}=(0,c.a)(),[u,m]=(0,n.useState)(null!==(s=o.firstName)&&void 0!==s?s:""),[p,h]=(0,n.useState)(null!==(a=o.lastName)&&void 0!==a?a:""),[v,f]=(0,n.useState)(null!==(i=o.region)&&void 0!==i?i:""),g="producer"===o.role?"Producteur":"admin"===o.role?"Admin":"Consommateur",[x,N]=(0,n.useState)(!!o.consentNewsletter),[j,y]=(0,n.useState)(!!o.consentAnalytics),[b,_]=(0,n.useState)(!1),[w,A]=(0,n.useState)(null),[S,k]=(0,n.useState)(null),C=async e=>{e.preventDefault(),A(null),k(null);let s=(0,l.Z6)();if(!s){A("Veuillez vous reconnecter.");return}_(!0);try{await r(s.accessToken,{firstName:u,lastName:p,region:v,consentNewsletter:x,consentAnalytics:j}),k("Profil mis a jour.");try{await d()}catch(e){}}catch(e){if(e&&"object"==typeof e&&"payload"in e){let s=e.payload;if(s&&"object"==typeof s&&"detail"in s){let e=s.detail;A("string"==typeof e?e:"Mise a jour impossible.")}else A("Mise a jour impossible.")}else e instanceof Error?A(e.message):A("Mise a jour impossible.")}finally{_(!1)}};return(0,t.jsxs)("form",{className:"grid",style:{gap:"var(--space-3)"},onSubmit:C,children:[(0,t.jsxs)("div",{className:"card",style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[(0,t.jsx)("span",{className:"badge",children:g}),(0,t.jsxs)("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:["Email : ",o.email]}),(0,t.jsxs)("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:["Compte cr\xe9\xe9 le ",new Date(o.createdAt).toLocaleDateString("fr-FR")]})]}),(0,t.jsxs)("div",{className:"grid",style:{gap:"var(--space-2)",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))"},children:[(0,t.jsxs)("label",{className:"input-label",children:["Prenom",(0,t.jsx)("input",{className:"input",value:u,onChange:e=>m(e.target.value)})]}),(0,t.jsxs)("label",{className:"input-label",children:["Nom",(0,t.jsx)("input",{className:"input",value:p,onChange:e=>h(e.target.value)})]})]}),(0,t.jsxs)("label",{className:"input-label",children:["Region",(0,t.jsx)("input",{className:"input",value:v,onChange:e=>f(e.target.value),placeholder:"Occitanie, Ile-de-France, ..."})]}),(0,t.jsxs)("label",{className:"checkbox",children:[(0,t.jsx)("input",{type:"checkbox",checked:x,onChange:e=>N(e.target.checked)}),"Recevoir des nouvelles responsables (newsletter)"]}),(0,t.jsxs)("label",{className:"checkbox",children:[(0,t.jsx)("input",{type:"checkbox",checked:j,onChange:e=>y(e.target.checked)}),"Partager des donnees d'usage anonymisees (amelioration)"]}),"producer"===o.role?(0,t.jsxs)("div",{className:"alert alert--info",children:["Profil producteur : rendez-vous sur ",(0,t.jsx)("strong",{children:"Producteurs > Dashboard"})," pour g\xe9rer vos produits, commandes et recommandations IA."]}):null,"admin"===o.role?(0,t.jsx)("div",{className:"alert alert--info",children:"Profil admin : g\xe9rez les utilisateurs et rapports depuis le menu Administration."}):null,w?(0,t.jsx)("div",{className:"alert alert--warning",children:w}):null,S?(0,t.jsx)("div",{className:"alert alert--success",children:S}):null,(0,t.jsx)("div",{children:(0,t.jsx)("button",{className:"btn btn--primary",type:"submit",disabled:b,children:b?"Enregistrement...":"Enregistrer"})})]})}function u(){let{user:e}=(0,c.a)();return(0,t.jsx)("main",{className:"container",style:{display:"grid",gap:"var(--space-12)"},children:(0,t.jsx)("section",{className:"section",children:(0,t.jsxs)("div",{style:{display:"grid",gap:"var(--space-3)"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"badge badge--impact",children:"Mon compte"}),(0,t.jsx)("h1",{style:{marginTop:"var(--space-2)"},children:"Profil"}),(0,t.jsx)("p",{className:"muted",children:"Mettez a jour vos informations personnelles."})]}),e?(0,t.jsx)(d,{user:e}):(0,t.jsx)("p",{className:"muted",children:"Veuillez vous connecter."})]})})})}function m(){return(0,t.jsx)(o.Z,{requireAuth:!0,children:()=>(0,t.jsx)(u,{})})}}},function(e){e.O(0,[972,697,741,971,117,744],function(){return e(e.s=2659)}),_N_E=e.O()}]);