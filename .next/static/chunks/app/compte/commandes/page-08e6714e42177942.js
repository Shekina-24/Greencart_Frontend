(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[172],{3062:function(e,s,a){Promise.resolve().then(a.bind(a,5438))},5438:function(e,s,a){"use strict";a.d(s,{default:function(){return u}});var n=a(7437),t=a(7648),r=a(2265),l=a(4730),i=a(1741),c=a(8316);function d(e,s){return"".concat((e/100).toFixed(2)," ").concat(s)}function o(e){let{experience:s,successOrder:a}=e,{user:i}=(0,l.a)(),o=s.openAuthModal,{orders:u,isLoading:m,error:p}=(0,c.Y)(!!i);(0,r.useEffect)(()=>{i||o("login")},[i,o]),(0,r.useEffect)(()=>{p&&"missing-token"===p.message&&o("login")},[p,o]);let h=(0,r.useMemo)(()=>p&&"missing-token"!==p.message?(console.error("[OrdersPage] Failed to load orders",p),"Impossible de recuperer vos commandes."):null,[p]);return(0,n.jsxs)("main",{className:"container",style:{display:"grid",gap:"var(--space-12)"},children:[(0,n.jsxs)("nav",{"aria-label":"Fil d'ariane",style:{fontSize:"var(--fs-small)"},children:[(0,n.jsx)(t.default,{className:"muted",href:"/catalogue",children:"Catalogue"})," / Mes commandes"]}),(0,n.jsx)("section",{className:"section",children:(0,n.jsxs)("div",{style:{display:"grid",gap:"var(--space-3)"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"badge badge--impact",children:"Historique"}),(0,n.jsx)("h1",{style:{marginTop:"var(--space-2)"},children:"Mes commandes"}),(0,n.jsx)("p",{className:"muted",children:"Suivez vos commandes passees et leur impact carbone evite."})]}),a?(0,n.jsxs)("div",{className:"alert alert--success",role:"status",children:["Commande #",a," confirmï¿½e. Merci pour votre achat !"]}):null,h?(0,n.jsx)("div",{className:"alert alert--warning",children:h}):null,m?(0,n.jsx)("p",{className:"muted",children:"Chargement des commandes..."}):0===u.length?(0,n.jsx)("p",{className:"muted",children:"Vous n'avez pas encore passe de commande."}):(0,n.jsx)("div",{className:"grid",style:{gap:"var(--space-3)"},children:u.map(e=>(0,n.jsxs)("article",{className:"card",style:{gap:"var(--space-2)"},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:"var(--space-2)"},children:[(0,n.jsxs)("strong",{children:["Commande #",e.id]}),(0,n.jsx)("span",{className:"muted",children:new Date(e.createdAt).toLocaleString("fr-FR")})]}),(0,n.jsxs)("div",{className:"muted",style:{fontSize:"var(--fs-small)",display:"flex",gap:"8px",alignItems:"center"},children:[(0,n.jsx)("span",{className:"badge ".concat("paid"===e.status?"badge--impact":"cancelled"===e.status?"badge--secondary":"refunded"===e.status?"badge--secondary":""),children:e.status}),(0,n.jsxs)("span",{children:[e.totalItems," article",e.totalItems>1?"s":""]})]}),(0,n.jsx)("div",{style:{display:"grid",gap:"var(--space-1)"},children:e.lines.map(s=>(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,n.jsx)("span",{children:s.productTitle}),(0,n.jsx)("span",{children:d(s.subtotalCents,e.currency)})]},s.id))}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:600},children:[(0,n.jsx)("span",{children:"Total"}),(0,n.jsx)("span",{children:d(e.totalAmountCents,e.currency)})]}),(0,n.jsxs)("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:["Impact carbone evite : ",(e.totalImpactCo2Grams/1e3).toFixed(1)," kg CO2e"]})]},e.id))})]})})]})}function u(){let{successOrder:e=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,n.jsx)(i.Z,{requireAuth:!0,children:s=>(0,n.jsx)(o,{experience:s,successOrder:e})})}},8316:function(e,s,a){"use strict";a.d(s,{Y:function(){return i}});var n=a(2265),t=a(7086),r=a(8822),l=a(2755);function i(e){let s=(0,n.useMemo)(()=>{if(!e)return null;let s=(0,r.Z6)();return s?["orders",s.accessToken]:"orders-missing-token"},[e]),{data:a,error:i,isLoading:c,mutate:d}=(0,t.ZP)(s,async()=>{let e=(0,r.Z6)();if(!e)throw Error("missing-token");return(await (0,l.AU)(e.accessToken)).items},{revalidateOnFocus:!1,shouldRetryOnError:e=>"missing-token"!==e.message});return{orders:null!=a?a:[],isLoading:c,error:i,mutate:d}}}},function(e){e.O(0,[972,697,86,741,971,117,744],function(){return e(e.s=3062)}),_N_E=e.O()}]);