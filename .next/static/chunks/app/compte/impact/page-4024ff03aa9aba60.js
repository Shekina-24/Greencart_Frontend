(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[655],{4172:function(e,s,a){Promise.resolve().then(a.bind(a,9064))},9064:function(e,s,a){"use strict";a.d(s,{default:function(){return o}});var n=a(7437),r=a(2265),t=a(4730),l=a(1741),c=a(8316);function i(e){return"".concat((e/100).toFixed(2)," EUR")}function d(){let{user:e}=(0,t.a)(),{orders:s,isLoading:a,error:l}=(0,c.Y)(!!e);(0,r.useEffect)(()=>{!e&&l&&"missing-token"===l.message&&console.warn("[ImpactPage] Missing authentication for impact data")},[e,l]);let d=(0,r.useMemo)(()=>l&&"missing-token"!==l.message?"Impossible de charger les donnees d'impact.":null,[l]),o=s.length,m=s.reduce((e,s)=>e+s.totalItems,0),u=s.reduce((e,s)=>e+s.totalImpactCo2Grams,0)/1e3,p=s.reduce((e,s)=>e+s.totalAmountCents,0),h=s.reduce((e,s)=>e+s.lines.reduce((e,s)=>{var a;return e+Math.max((null!==(a=s.referencePriceCents)&&void 0!==a?a:s.unitPriceCents)*s.quantity-s.subtotalCents,0)},0),0);return(0,n.jsx)("main",{className:"container",style:{display:"grid",gap:"var(--space-12)"},children:(0,n.jsx)("section",{className:"section",children:(0,n.jsxs)("div",{style:{display:"grid",gap:"var(--space-3)"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"badge badge--impact",children:"Mon impact"}),(0,n.jsx)("h1",{style:{marginTop:"var(--space-2)"},children:"Impact carbone et achats responsables"}),(0,n.jsx)("p",{className:"muted",children:"Bilan calcule a partir de vos commandes valides."})]}),d?(0,n.jsx)("div",{className:"alert alert--warning",children:d}):null,a?(0,n.jsx)("p",{className:"muted",children:"Chargement..."}):(0,n.jsxs)("div",{className:"grid",style:{gap:"var(--space-3)",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))"},children:[(0,n.jsxs)("article",{className:"card",style:{gap:"var(--space-2)"},children:[(0,n.jsx)("strong",{children:o}),(0,n.jsx)("span",{className:"muted",style:{fontSize:"var(--fs-small)"},children:"Commandes total"})]}),(0,n.jsxs)("article",{className:"card",style:{gap:"var(--space-2)"},children:[(0,n.jsx)("strong",{children:m}),(0,n.jsx)("span",{className:"muted",style:{fontSize:"var(--fs-small)"},children:"Articles sauves"})]}),(0,n.jsxs)("article",{className:"card",style:{gap:"var(--space-2)"},children:[(0,n.jsx)("strong",{children:"".concat(u.toFixed(1)," kg CO2e")}),(0,n.jsx)("span",{className:"muted",style:{fontSize:"var(--fs-small)"},children:"COâ‚‚ evites"})]}),(0,n.jsxs)("article",{className:"card",style:{gap:"var(--space-2)"},children:[(0,n.jsx)("strong",{children:i(p)}),(0,n.jsx)("span",{className:"muted",style:{fontSize:"var(--fs-small)"},children:"Total depense"})]}),(0,n.jsxs)("article",{className:"card",style:{gap:"var(--space-2)"},children:[(0,n.jsx)("strong",{children:i(o>0?p/o:0)}),(0,n.jsx)("span",{className:"muted",style:{fontSize:"var(--fs-small)"},children:"Panier moyen"})]}),(0,n.jsxs)("article",{className:"card",style:{gap:"var(--space-2)"},children:[(0,n.jsx)("strong",{children:i(h)}),(0,n.jsx)("span",{className:"muted",style:{fontSize:"var(--fs-small)"},children:"\xc9conomies r\xe9alis\xe9es"})]})]})]})})})}function o(){return(0,n.jsx)(l.Z,{requireAuth:!0,children:()=>(0,n.jsx)(d,{})})}},8316:function(e,s,a){"use strict";a.d(s,{Y:function(){return c}});var n=a(2265),r=a(7086),t=a(8822),l=a(2755);function c(e){let s=(0,n.useMemo)(()=>{if(!e)return null;let s=(0,t.Z6)();return s?["orders",s.accessToken]:"orders-missing-token"},[e]),{data:a,error:c,isLoading:i,mutate:d}=(0,r.ZP)(s,async()=>{let e=(0,t.Z6)();if(!e)throw Error("missing-token");return(await (0,l.AU)(e.accessToken)).items},{revalidateOnFocus:!1,shouldRetryOnError:e=>"missing-token"!==e.message});return{orders:null!=a?a:[],isLoading:i,error:c,mutate:d}}}},function(e){e.O(0,[972,697,86,741,971,117,744],function(){return e(e.s=4172)}),_N_E=e.O()}]);