(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{9798:function(e,t,n){Promise.resolve().then(n.t.bind(n,7960,23)),Promise.resolve().then(n.bind(n,8648))},8648:function(e,t,n){"use strict";n.d(t,{default:function(){return d}});var r=n(7437),a=n(4730),s=n(8870),o=n(2265),i=n(8439);let c="GTM-XXXXXXX";function u(){let[e,t]=(0,o.useState)(()=>(0,i.Hp)()),n=(0,o.useRef)(!1);return(0,o.useEffect)(()=>{c&&e&&(n.current||(function(e){if(document.getElementById("greencart-gtm"))return;window.dataLayer=window.dataLayer||[],window.dataLayer.push({"gtm.start":new Date().getTime(),event:"gtm.js"});let t=document.createElement("script");t.id="greencart-gtm",t.async=!0,t.src="https://www.googletagmanager.com/gtm.js?id=".concat(encodeURIComponent(e)),document.head.appendChild(t)}(c),n.current=!0))},[e]),(0,o.useEffect)(()=>{let e=()=>{t((0,i.Hp)())};return window.addEventListener(i.CB,e),()=>window.removeEventListener(i.CB,e)},[]),null}function l(){let[e,t]=(0,o.useState)(!1);(0,o.useEffect)(()=>{let e=(0,i.dU)();t("granted"!==e&&"denied"!==e)},[]);let n=(0,o.useCallback)(e=>{(0,i.as)(e),t(!1)},[]);return e?(0,r.jsx)("div",{role:"dialog","aria-live":"polite",className:"card",style:{position:"fixed",bottom:16,left:16,right:16,maxWidth:720,margin:"0 auto",zIndex:1e3},children:(0,r.jsxs)("div",{style:{display:"grid",gap:"8px"},children:[(0,r.jsx)("strong",{children:"Cookies d'analyse (GTM/GA)"}),(0,r.jsx)("p",{className:"muted",style:{margin:0},children:"Nous utilisons des cookies d'analyse pour comprendre l'usage et am\xe9liorer GreenCart. Vous pouvez accepter ou refuser."}),(0,r.jsxs)("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end",flexWrap:"wrap"},children:[(0,r.jsx)("button",{className:"btn",type:"button",onClick:()=>n("denied"),children:"Refuser"}),(0,r.jsx)("button",{className:"btn btn--primary",type:"button",onClick:()=>n("granted"),children:"Accepter"})]})]})}):null}function d(e){let{children:t}=e;return(0,r.jsx)(a.H,{children:(0,r.jsxs)(s.V,{children:[(0,r.jsx)(u,{}),(0,r.jsx)(l,{}),t]})})}},8870:function(e,t,n){"use strict";n.d(t,{V:function(){return o},p:function(){return i}});var r=n(7437),a=n(2265);let s=(0,a.createContext)(void 0);function o(e){let{children:t}=e,[n,o]=(0,a.useState)([]),i=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,r="".concat(Date.now(),"-").concat(Math.random());o(a=>[...a,{id:r,message:e,type:t,timeoutMs:n}]),window.setTimeout(()=>{o(e=>e.filter(e=>e.id!==r))},n)},[]),c=(0,a.useMemo)(()=>({showToast:i}),[i]);return(0,r.jsxs)(s.Provider,{value:c,children:[t,(0,r.jsx)("div",{style:{position:"fixed",right:16,bottom:16,display:"grid",gap:"8px",zIndex:1e3},"aria-live":"polite","aria-atomic":!0,children:n.map(e=>(0,r.jsx)("div",{className:"alert ".concat("success"===e.type?"alert--success":"warning"===e.type?"alert--warning":"error"===e.type?"alert--warning":""),role:"status",children:e.message},e.id))})]})}function i(){let e=(0,a.useContext)(s);if(!e)throw Error("useToast must be used within ToastProvider");return e}},4730:function(e,t,n){"use strict";n.d(t,{H:function(){return m},a:function(){return w}});var r=n(7437),a=n(2265),s=n(9376),o=n(8822),i=n(9116);async function c(e){let t=await (0,i.S)("/auth/login",{method:"POST",body:JSON.stringify(e)});return(0,o.XC)({accessToken:t.access_token,refreshToken:t.refresh_token}),{user:await d(t.access_token),tokens:{accessToken:t.access_token,refreshToken:t.refresh_token}}}async function u(e){var t,n,r;let a={email:e.email,password:e.password,role:null!==(t=e.role)&&void 0!==t?t:"consumer",first_name:e.firstName,last_name:e.lastName,region:e.region,consent_newsletter:null!==(n=e.consentNewsletter)&&void 0!==n&&n,consent_analytics:null!==(r=e.consentAnalytics)&&void 0!==r&&r};return f(await (0,i.S)("/auth/register",{method:"POST",body:JSON.stringify(a)}))}async function l(e){let t=await (0,i.S)("/auth/refresh",{method:"POST",body:JSON.stringify({refresh_token:e})});return(0,o.XC)({accessToken:t.access_token,refreshToken:t.refresh_token}),{accessToken:t.access_token,refreshToken:t.refresh_token}}async function d(e){return f(await (0,i.S)("/auth/me",{authToken:e}))}function f(e){return{id:e.id,email:e.email,role:e.role,firstName:e.first_name,lastName:e.last_name,region:e.region,isActive:e.is_active,emailVerifiedAt:e.email_verified_at,lastLoginAt:e.last_login_at,consentNewsletter:e.consent_newsletter,consentAnalytics:e.consent_analytics,createdAt:e.created_at,updatedAt:e.updated_at}}let h=(0,a.createContext)(void 0);function m(e){let{children:t}=e,[n,i]=(0,a.useState)(null),[l,d]=(0,a.useState)(!0),f=(0,s.useRouter)();(0,a.useEffect)(()=>{let e=!0;return(async()=>{let t=(0,o.Z6)();if(!t){e&&d(!1);return}try{let n=await g(t);e&&i(n)}catch(t){(0,o.ZP)(),e&&i(null)}finally{e&&d(!1)}})(),()=>{e=!1}},[]);let m=(0,a.useCallback)(async e=>{try{let t=await c(e);return i(t.user),{success:!0}}catch(e){return{success:!1,error:p(e)}}},[]),w=(0,a.useCallback)(async e=>{try{await u(e);let t=await m({email:e.email,password:e.password});if(!t.success)return t;return{success:!0}}catch(e){return{success:!1,error:p(e)}}},[m]),y=(0,a.useCallback)(()=>{(0,o.ZP)(),i(null);try{f.push("/landing")}catch(e){}},[f]),v=(0,a.useCallback)(async()=>{let e=(0,o.Z6)();if(e)try{let t=await g(e);i(t)}catch(e){}},[]),k=(0,a.useMemo)(()=>({user:n,isAuthenticating:l,login:m,register:w,logout:y,reloadUser:v}),[n,l,m,w,y,v]);return(0,r.jsx)(h.Provider,{value:k,children:t})}function w(){let e=(0,a.useContext)(h);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}async function g(e){try{return await d(e.accessToken)}catch(t){return d((await l(e.refreshToken)).accessToken)}}function p(e){if(e&&"object"==typeof e&&"payload"in e){let t=e.payload;if("string"==typeof t)return t;if(t&&"object"==typeof t&&"detail"in t){let e=t.detail;if("string"==typeof e)return e;if(Array.isArray(e)&&e.length>0)return String(e[0])}}return e instanceof Error?e.message:"Une erreur est survenue. Merci de reessayer."}},8439:function(e,t,n){"use strict";n.d(t,{CB:function(){return a},Hp:function(){return o},as:function(){return i},dU:function(){return s}});let r="greencart_consent_analytics",a="greencart:consent-changed";function s(){let e=window.localStorage.getItem(r);return"granted"===e||"denied"===e?e:null}function o(){return"granted"===s()}function i(e){window.localStorage.setItem(r,e),window.dispatchEvent(new Event(a))}},9116:function(e,t,n){"use strict";n.d(t,{S:function(){return a},r:function(){return o}});let r="http://localhost:8000".replace(/\/+$/,"");async function a(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{params:a,authToken:o,headers:i,next:c,cache:u,...l}=n,d=function(e,t){let n=new URL("".concat("/api/v1").concat(e),r);return t&&Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).forEach(e=>{let[t,r]=e;return n.searchParams.set(t,String(r))}),n}(e,a),f=(null!==(t=l.method)&&void 0!==t?t:"GET").toString().toUpperCase(),h="GET"===f,m=null!=c?c:!o&&h?{revalidate:300}:void 0,w=await fetch(d,{...l,method:f,headers:{"Content-Type":"application/json",...o?{Authorization:"Bearer ".concat(o)}:{},...null!=i?i:{}},cache:null!=u?u:o||!h?"no-store":void 0,...m?{next:m}:{}});if(!w.ok){let e=await s(w),t=Error("API request failed with ".concat(w.status," ").concat(w.statusText));throw t.status=w.status,t.payload=e,t}return await s(w)}async function s(e){let t=await e.text();if(!t)return null;try{return JSON.parse(t)}catch(e){return t}}function o(){return r}},8822:function(e,t,n){"use strict";n.d(t,{XC:function(){return s},Z6:function(){return o},ZP:function(){return i}});let r="greencart_access_token",a="greencart_refresh_token";function s(e){window.localStorage.setItem(r,e.accessToken),window.localStorage.setItem(a,e.refreshToken)}function o(){let e=window.localStorage.getItem(r),t=window.localStorage.getItem(a);return e&&t?{accessToken:e,refreshToken:t}:null}function i(){window.localStorage.removeItem(r),window.localStorage.removeItem(a)}},9376:function(e,t,n){"use strict";var r=n(5475);n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},7960:function(){}},function(e){e.O(0,[587,971,117,744],function(){return e(e.s=9798)}),_N_E=e.O()}]);