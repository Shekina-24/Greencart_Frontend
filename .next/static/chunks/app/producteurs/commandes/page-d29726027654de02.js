(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[498],{886:function(e,t,n){Promise.resolve().then(n.bind(n,5480))},5480:function(e,t,n){"use strict";n.d(t,{default:function(){return m}});var s=n(7437),i=n(2265),a=n(8822),r=n(6144),l=n(8870),o=n(4730),c=n(1741);function d(e){let{height:t=80,width:n="100%"}=e;return(0,s.jsx)("div",{"aria-hidden":!0,style:{height:t,width:n,borderRadius:8,background:"linear-gradient(90deg, rgba(0,0,0,0.06) 25%, rgba(0,0,0,0.09) 37%, rgba(0,0,0,0.06) 63%)",backgroundSize:"400% 100%",animation:"gc-skeleton 1.4s ease infinite"}})}function u(e){return"".concat((e/100).toFixed(2)," EUR")}function p(){let{user:e}=(0,o.a)(),[t,n]=(0,i.useState)([]),[c,p]=(0,i.useState)(!1),[m,g]=(0,i.useState)(null),[v,f]=(0,i.useState)(1),[h]=(0,i.useState)(20),{showToast:x}=(0,l.p)(),[y,_]=(0,i.useState)(""),[j,C]=(0,i.useState)(""),[b,w]=(0,i.useState)(""),[S,N]=(0,i.useState)("date_desc");(0,i.useEffect)(()=>{if(!e)return;let t=(0,a.Z6)();t&&(p(!0),g(null),(0,r.Au)(t.accessToken,{limit:h,offset:(v-1)*h}).then(e=>n(e.items)).catch(()=>g("Impossible de charger les commandes.")).finally(()=>p(!1)))},[e,v,h]);let k=(()=>{let e=y.trim().toLowerCase(),n=e?t.filter(t=>"".concat(t.customerEmail," ").concat(t.orderId).toLowerCase().includes(e)):t.slice();if(j){let e=new Date(j).getTime();n=n.filter(t=>new Date(t.createdAt).getTime()>=e)}if(b){let e=new Date(b).getTime();n=n.filter(t=>new Date(t.createdAt).getTime()<=e)}return n.sort((e,t)=>"total_desc"===S?t.totalAmountCents-e.totalAmountCents:new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()),n})();return(0,s.jsx)("main",{className:"container",style:{display:"grid",gap:"var(--space-12)"},children:(0,s.jsx)("section",{className:"section",children:(0,s.jsxs)("div",{style:{display:"grid",gap:"var(--space-3)"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"badge badge--impact",children:"Espace producteur"}),(0,s.jsx)("h1",{style:{marginTop:"var(--space-2)"},children:"Commandes"}),(0,s.jsx)("p",{className:"muted",children:"Commandes contenant vos produits."})]}),m?(0,s.jsx)("div",{className:"alert alert--warning",children:m}):null,c?(0,s.jsx)("div",{className:"grid",style:{gap:"var(--space-3)"},children:Array.from({length:4}).map((e,t)=>(0,s.jsx)(d,{height:120},t))}):0===k.length?(0,s.jsx)("p",{className:"muted",children:"Aucune commande pour l'instant."}):(0,s.jsx)("div",{className:"grid",style:{gap:"var(--space-3)"},children:k.map(e=>(0,s.jsxs)("article",{className:"card",style:{gap:"var(--space-2)"},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,s.jsxs)("strong",{children:["Commande #",e.orderId]}),(0,s.jsx)("span",{className:"muted",style:{fontSize:"var(--fs-small)"},children:new Date(e.createdAt).toLocaleString("fr-FR")})]}),(0,s.jsxs)("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:["Client: ",e.customerEmail," \xb7 Statut: ",e.status]}),(0,s.jsx)("div",{style:{display:"grid",gap:"var(--space-1)"},children:e.lines.map(e=>(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,s.jsxs)("span",{children:[e.productTitle," x",e.quantity]}),(0,s.jsx)("span",{children:u(e.subtotalCents)})]},e.id))}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:600},children:[(0,s.jsx)("span",{children:"Total"}),(0,s.jsx)("span",{children:u(e.totalAmountCents)})]})]},e.orderId))}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",flexWrap:"wrap"},children:[(0,s.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center",flexWrap:"wrap"},children:[(0,s.jsx)("input",{className:"input",placeholder:"Rechercher (email, #id)",value:y,onChange:e=>_(e.target.value)}),(0,s.jsxs)("select",{className:"select",value:S,onChange:e=>N(e.target.value),children:[(0,s.jsx)("option",{value:"date_desc",children:"Plus r\xe9centes"}),(0,s.jsx)("option",{value:"total_desc",children:"Total d\xe9croissant"})]}),(0,s.jsx)("input",{className:"input",type:"date",value:j,onChange:e=>C(e.target.value)}),(0,s.jsx)("input",{className:"input",type:"date",value:b,onChange:e=>w(e.target.value)})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,s.jsx)("button",{className:"btn btn--ghost",type:"button",disabled:v<=1,onClick:()=>f(e=>Math.max(1,e-1)),children:"Prec."}),(0,s.jsx)("button",{className:"btn btn--ghost",type:"button",onClick:()=>f(e=>e+1),children:"Suiv."})]}),(0,s.jsx)("button",{className:"btn",type:"button",onClick:()=>{if(0===k.length){x("Aucune commande \xe0 exporter","warning");return}let e=new Blob([["order_id,status,created_at,customer_email,line_count,total_cents",...k.map(e=>[e.orderId,e.status,e.createdAt,e.customerEmail,e.lines.length,e.totalAmountCents]).map(e=>e.join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="commandes_producteur.csv",n.click(),URL.revokeObjectURL(t)},children:"Exporter CSV"})]})]})})})}function m(){return(0,s.jsx)(c.Z,{requireAuth:!0,requiredRole:"producer",children:()=>(0,s.jsx)(p,{})})}},8870:function(e,t,n){"use strict";n.d(t,{V:function(){return r},p:function(){return l}});var s=n(7437),i=n(2265);let a=(0,i.createContext)(void 0);function r(e){let{children:t}=e,[n,r]=(0,i.useState)([]),l=(0,i.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,s="".concat(Date.now(),"-").concat(Math.random());r(i=>[...i,{id:s,message:e,type:t,timeoutMs:n}]),window.setTimeout(()=>{r(e=>e.filter(e=>e.id!==s))},n)},[]),o=(0,i.useMemo)(()=>({showToast:l}),[l]);return(0,s.jsxs)(a.Provider,{value:o,children:[t,(0,s.jsx)("div",{style:{position:"fixed",right:16,bottom:16,display:"grid",gap:"8px",zIndex:1e3},"aria-live":"polite","aria-atomic":!0,children:n.map(e=>(0,s.jsx)("div",{className:"alert ".concat("success"===e.type?"alert--success":"warning"===e.type?"alert--warning":"error"===e.type?"alert--warning":""),role:"status",children:e.message},e.id))})]})}function l(){let e=(0,i.useContext)(a);if(!e)throw Error("useToast must be used within ToastProvider");return e}},6144:function(e,t,n){"use strict";n.d(t,{Au:function(){return d},J8:function(){return l},VP:function(){return a},et:function(){return o},sJ:function(){return r},ud:function(){return c}});var s=n(9116),i=n(2139);async function a(e){let t=await (0,s.S)("/producer/insights",{authToken:e});return{totalOrders:t.total_orders,totalRevenueCents:t.total_revenue_cents,totalItemsSold:t.total_items_sold,averageOrderValueCents:t.average_order_value_cents,totalImpactCo2Grams:t.total_impact_co2_g,topProducts:t.top_products.map(e=>{var t;return{productId:e.product_id,title:e.title,revenueCents:e.revenue_cents,unitsSold:e.units_sold,averageRating:null!==(t=e.average_rating)&&void 0!==t?t:null}})}}async function r(e){var t,n;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=await (0,s.S)("/producer/products",{authToken:e,params:{limit:null!==(t=a.limit)&&void 0!==t?t:20,offset:null!==(n=a.offset)&&void 0!==n?n:0}});return{items:r.items.map(i.fm),total:r.total,limit:r.limit,offset:r.offset}}async function l(e,t){var n,a,r,l,o,c,d,u,p;let m={title:t.title,price_cents:t.priceCents,stock:t.stock,description:null!==(n=t.description)&&void 0!==n?n:null,category:null!==(a=t.category)&&void 0!==a?a:null,region:null!==(r=t.region)&&void 0!==r?r:null,origin:null!==(l=t.origin)&&void 0!==l?l:null,dlc_date:null!==(o=t.dlcDate)&&void 0!==o?o:null,impact_co2_g:null!==(c=t.impactCo2Grams)&&void 0!==c?c:null,promo_price_cents:null!==(d=t.promoPriceCents)&&void 0!==d?d:null,is_published:null!==(u=t.isPublished)&&void 0!==u&&u,images:(null!==(p=t.images)&&void 0!==p?p:[]).map(e=>({url:e.url,is_primary:!!e.isPrimary}))};t.status&&(m.status=t.status);let g=await (0,s.S)("/products",{method:"POST",authToken:e,body:JSON.stringify(m)});return(0,i.fm)(g)}async function o(e,t,n){let a={};void 0!==n.title&&(a.title=n.title),void 0!==n.description&&(a.description=n.description),void 0!==n.category&&(a.category=n.category),void 0!==n.region&&(a.region=n.region),void 0!==n.origin&&(a.origin=n.origin),void 0!==n.dlcDate&&(a.dlc_date=n.dlcDate),void 0!==n.impactCo2Grams&&(a.impact_co2_g=n.impactCo2Grams),void 0!==n.priceCents&&(a.price_cents=n.priceCents),void 0!==n.promoPriceCents&&(a.promo_price_cents=n.promoPriceCents),void 0!==n.stock&&(a.stock=n.stock),void 0!==n.status&&(a.status=n.status),void 0!==n.isPublished&&(a.is_published=n.isPublished);let r=await (0,s.S)("/producer/products/".concat(t),{method:"PUT",authToken:e,body:JSON.stringify(a)});return(0,i.fm)(r)}async function c(e,t){await (0,s.S)("/producer/products/".concat(t),{method:"DELETE",authToken:e})}async function d(e){var t,n;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=await (0,s.S)("/producer/orders",{authToken:e,params:{limit:null!==(t=i.limit)&&void 0!==t?t:20,offset:null!==(n=i.offset)&&void 0!==n?n:0}});return{items:a.items.map(e=>({orderId:e.order_id,status:e.status,customerId:e.customer_id,customerEmail:e.customer_email,createdAt:e.created_at,totalAmountCents:e.total_amount_cents,lines:e.lines.map(e=>{var t;return{id:e.id,orderId:e.order_id,productId:e.product_id,productTitle:e.product_title,quantity:e.quantity,unitPriceCents:e.unit_price_cents,referencePriceCents:null!==(t=e.reference_price_cents)&&void 0!==t?t:null,subtotalCents:e.subtotal_cents,createdAt:e.created_at}})})),total:a.total,limit:a.limit,offset:a.offset}}}},function(e){e.O(0,[972,697,741,971,117,744],function(){return e(e.s=886)}),_N_E=e.O()}]);