(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[891],{8406:function(e,t,s){Promise.resolve().then(s.bind(s,9445))},9445:function(e,t,s){"use strict";s.d(t,{default:function(){return N}});var i=s(7437),a=s(7648),r=s(7010),n=s(8012),l=s(7238),o=s(5176),c=s(6471);let d=(0,c.Z)("Warehouse",[["path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z",key:"gksnxg"}],["path",{d:"M6 18h12",key:"9pbo8z"}],["path",{d:"M6 14h12",key:"4cwo0f"}],["rect",{width:"12",height:"12",x:"6",y:"10",key:"apd30q"}]]);var u=s(2265),p=s(4033),m=s(3145);function h(e){let{images:t,alt:s}=e,a=(0,u.useMemo)(()=>t.length>0?t:["https://images.unsplash.com/photo-1504674900247-0877df9cc836?q=80&w=1200&auto=format&fit=crop"],[t]),[r,n]=(0,u.useState)(0),l=a[Math.min(r,a.length-1)];return(0,i.jsxs)("div",{style:{display:"grid",gap:"var(--space-3)"},children:[(0,i.jsx)("div",{style:{position:"relative",width:"100%",paddingBottom:"65%",borderRadius:"var(--radius-lg)",overflow:"hidden",border:"1px solid var(--gc-border)"},children:(0,i.jsx)(m.default,{src:l,alt:s,fill:!0,sizes:"(max-width: 900px) 100vw, 640px",style:{objectFit:"cover"}})}),a.length>1?(0,i.jsx)("div",{style:{display:"grid",gap:"var(--space-2)",gridTemplateColumns:"repeat(auto-fit, minmax(80px, 1fr))"},children:a.map((e,t)=>(0,i.jsx)("button",{type:"button",onClick:()=>n(t),style:{position:"relative",paddingBottom:"70%",borderRadius:"var(--radius-sm)",overflow:"hidden",border:t===r?"2px solid var(--gc-primary)":"1px solid var(--gc-border)",cursor:"pointer"},"aria-label":"Voir l'image ".concat(t+1),"aria-pressed":t===r,children:(0,i.jsx)(m.default,{src:e,alt:"".concat(s," ").concat(t+1),fill:!0,style:{objectFit:"cover"},sizes:"100px",loading:"lazy"})},e))}):null]})}let g=(0,c.Z)("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);var v=s(8822),x=s(3627),y=s(2755),f=s(4730);let j={approved:"Publie",pending:"En attente de moderation",rejected:"Rejete"};function b(e){let{productId:t,initialReviews:s,totalReviews:a,onRequireAuth:r}=e,{user:n}=(0,f.a)(),[l,o]=(0,u.useState)(s),[c,d]=(0,u.useState)(5),[p,m]=(0,u.useState)(""),[h,b]=(0,u.useState)(!1),[k,C]=(0,u.useState)(null),[N,w]=(0,u.useState)(null),[S,_]=(0,u.useState)(!1),[z,M]=(0,u.useState)(s.length<a),[I,E]=(0,u.useState)(s.length),P=(0,u.useMemo)(()=>l.filter(e=>"rejected"!==e.status),[l]),[T,Z]=(0,u.useState)(null),[A,O]=(0,u.useState)(5),[R,W]=(0,u.useState)(""),V=async()=>{let e=(0,v.Z6)();if(!e)return null;try{let s=(await (0,y.AU)(e.accessToken,{limit:50,offset:0})).items.find(e=>("paid"===e.status||"completed"===e.status)&&e.lines.some(e=>e.productId===t));return s?s.id:null}catch(e){return null}},D=async e=>{if(e.preventDefault(),C(null),w(null),!n){r("login");return}let s=(0,v.Z6)();if(!s){r("login");return}b(!0);try{let e=await V(),i=await (0,x.XU)({product_id:t,rating:c,comment:p,order_id:null!=e?e:void 0},s.accessToken);o(e=>[i,...e]),m(""),d(5),w("approved"===i.status?"Votre avis est publie. Merci !":"Votre avis est en attente de moderation.")}catch(e){if(e instanceof Error){let t=e.payload;if(t&&"object"==typeof t&&"detail"in t){let e=t.detail;C("string"==typeof e?e:"Impossible d'enregistrer votre avis.")}else C(e.message)}else C("Impossible d'enregistrer votre avis.")}finally{b(!1)}},F=e=>{var t;Z(e.id),O(e.rating),W(null!==(t=e.comment)&&void 0!==t?t:"")},L=async()=>{if(!T)return;let e=(0,v.Z6)();if(!e){r("login");return}b(!0),C(null);try{let s=await V(),i=await (0,x.g8)(T,{product_id:t,rating:A,comment:R,order_id:null!=s?s:void 0},e.accessToken);o(e=>e.map(e=>e.id===i.id?i:e)),Z(null),w("approved"===i.status?"Votre avis a \xe9t\xe9 mis \xe0 jour.":"Votre avis \xe9dit\xe9 est en attente de mod\xe9ration.")}catch(e){C("Impossible de mettre \xe0 jour votre avis.")}finally{b(!1)}},q=async e=>{let t=(0,v.Z6)();if(!t){r("login");return}try{await (0,x.i0)(e,t.accessToken),o(t=>t.filter(t=>t.id!==e))}catch(e){C("Suppression impossible")}},H=async()=>{_(!0);try{let e=await (0,x.O)(t,{limit:20,offset:I});o(t=>[...t,...e.items]);let s=I+e.items.length;E(s),M(s<e.total)}catch(e){}finally{_(!1)}};return(0,i.jsx)("section",{className:"section",id:"avis",children:(0,i.jsxs)("div",{style:{display:"grid",gap:"var(--space-3)"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{children:"Avis consommateurs"}),(0,i.jsxs)("p",{className:"muted",children:[P.length," avis publies (sur ",a,"). Les avis sont valides pour limiter les faux retours."]})]}),P.length>0?(0,i.jsx)("div",{className:"grid",style:{gap:"var(--space-3)"},children:P.map(e=>{var t;return(0,i.jsxs)("article",{className:"card",style:{gap:"var(--space-2)"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-2)"},children:[(0,i.jsxs)("strong",{children:["Note ",e.rating,"/5"]}),(0,i.jsxs)("span",{className:"muted",style:{fontSize:"var(--fs-small)"},children:[null!==(t=j[e.status])&&void 0!==t?t:e.status," - ",new Date(e.createdAt).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric"})]})]}),T===e.id?(0,i.jsxs)("div",{className:"grid",style:{gap:"8px"},children:[(0,i.jsx)("div",{className:"input-label",children:"Modifier la note"}),(0,i.jsx)("div",{style:{display:"inline-flex",gap:"6px"},children:[1,2,3,4,5].map(e=>(0,i.jsx)("button",{type:"button",className:"btn btn--ghost",onClick:()=>O(e),"aria-label":"Choisir ".concat(e," sur 5"),children:(0,i.jsx)(g,{size:18,strokeWidth:1.5,fill:e<=A?"currentColor":"transparent"})},e))}),(0,i.jsx)("textarea",{className:"textarea",rows:3,value:R,onChange:e=>W(e.target.value)}),(0,i.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[(0,i.jsx)("button",{className:"btn btn--primary",type:"button",onClick:L,disabled:h,children:"Enregistrer"}),(0,i.jsx)("button",{className:"btn btn--ghost",type:"button",onClick:()=>Z(null),disabled:h,children:"Annuler"})]})]}):(0,i.jsxs)(i.Fragment,{children:[e.comment?(0,i.jsx)("p",{children:e.comment}):null,n&&n.id===e.userId?(0,i.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,i.jsx)("button",{className:"btn btn--ghost",type:"button",onClick:()=>F(e),children:"Modifier"}),(0,i.jsx)("button",{className:"btn btn--danger",type:"button",onClick:()=>q(e.id),children:"Supprimer"})]}):null]})]},e.id)})}):(0,i.jsx)("p",{className:"muted",children:"Encore aucun avis publie. Soyez le premier a partager votre retour !"}),z?(0,i.jsx)("div",{children:(0,i.jsx)("button",{className:"btn btn--ghost",type:"button",onClick:H,disabled:S,children:S?"Chargement...":"Voir plus d' avis"})}):null,(0,i.jsxs)("div",{className:"card",style:{gap:"var(--space-3)"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Laisser un avis"}),(0,i.jsx)("p",{className:"muted",children:"Notez votre experience produit (la moderation verifie la presence d'une commande associee)."})]}),(0,i.jsxs)("form",{className:"grid",style:{gap:"var(--space-3)"},onSubmit:D,children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"input-label",children:"Note"}),(0,i.jsx)("div",{style:{display:"inline-flex",gap:"6px"},children:[1,2,3,4,5].map(e=>(0,i.jsx)("button",{type:"button",className:"btn btn--ghost","aria-label":"Choisir ".concat(e," sur 5"),onClick:()=>d(e),children:(0,i.jsx)(g,{size:18,strokeWidth:1.5,fill:e<=c?"currentColor":"transparent"})},e))})]}),(0,i.jsxs)("label",{className:"input-label",children:["Commentaire (optionnel)",(0,i.jsx)("textarea",{className:"textarea",placeholder:"Partagez les points positifs et les ameliorations possibles.",value:p,onChange:e=>m(e.target.value),rows:4,maxLength:1e3})]}),k?(0,i.jsx)("p",{style:{color:"var(--gc-danger)",margin:0,fontSize:"var(--fs-small)"},children:k}):null,N?(0,i.jsx)("p",{style:{color:"var(--gc-success)",margin:0,fontSize:"var(--fs-small)"},children:N}):null,(0,i.jsxs)("div",{style:{display:"flex",gap:"var(--space-2)",flexWrap:"wrap"},children:[(0,i.jsx)("button",{className:"btn btn--primary",type:"submit",disabled:h,children:h?"Envoi en cours...":"Publier mon avis"}),n?null:(0,i.jsx)("button",{className:"btn btn--ghost",type:"button",onClick:()=>r("login"),children:"Se connecter"})]})]})]})]})})}var k=s(1741);function C(e){var t,s,c;let{product:m,reviews:g,reviewsTotal:v,experience:x}=e,y=(0,u.useMemo)(()=>m.images&&m.images.length>0?m.images.slice().sort((e,t)=>Number(t.isPrimary)-Number(e.isPrimary)).map(e=>e.url):[m.image],[m.images,m.image]);return(0,u.useEffect)(()=>{var e,t;(0,p.Sg)({id:m.id,name:m.name,priceCents:null!==(t=null!==(e=m.priceCents)&&void 0!==e?e:m.promoPriceCents)&&void 0!==t?t:null,category:m.category,region:m.region})},[m]),(0,i.jsxs)("main",{className:"container",style:{display:"grid",gap:"var(--space-12)"},children:[(0,i.jsx)("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify({"@context":"https://schema.org/","@type":"Product",name:m.name,description:m.description,image:m.images&&m.images.length>0?m.images.map(e=>e.url):[m.image],category:m.category,offers:{"@type":"Offer",priceCurrency:"EUR",price:(null!==(s=null!==(t=m.promoPriceCents)&&void 0!==t?t:m.priceCents)&&void 0!==s?s:Math.round(100*m.price))/100,availability:"number"==typeof m.stock&&m.stock<=0?"https://schema.org/OutOfStock":"https://schema.org/InStock"}})}}),(0,i.jsxs)("nav",{"aria-label":"Fil d'ariane",style:{fontSize:"var(--fs-small)"},children:[(0,i.jsx)(a.default,{className:"muted",href:"/catalogue",children:"Retour au catalogue"})," / ",(0,i.jsx)("span",{children:m.name})]}),(0,i.jsx)("section",{className:"section",children:(0,i.jsxs)("div",{className:"grid",style:{gap:"var(--space-6)",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))"},children:[(0,i.jsx)(h,{images:y,alt:m.name}),(0,i.jsxs)("div",{style:{display:"grid",gap:"var(--space-4)"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"badge badge--impact",children:"Impact mesure"}),(0,i.jsx)("h1",{style:{marginTop:"var(--space-2)"},children:m.name}),(0,i.jsxs)("p",{className:"muted",children:[m.category," - ",m.region]})]}),(0,i.jsxs)("div",{className:"card",style:{gap:"var(--space-3)"},children:[(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"var(--space-2)"},children:[(0,i.jsxs)("strong",{style:{fontSize:"1.75rem"},children:[null!=m.promoPriceCents?(m.promoPriceCents/100).toFixed(2):null!=m.priceCents?(m.priceCents/100).toFixed(2):m.price.toFixed(2)," EUR"]}),null!=m.promoPriceCents?(0,i.jsxs)("span",{className:"muted",style:{textDecoration:"line-through"},children:[(null!==(c=m.priceCents)&&void 0!==c?c:100*m.price)/100," EUR"]}):null,(0,i.jsx)("p",{children:m.description})]}),(0,i.jsxs)("div",{style:{display:"grid",gap:"var(--space-2)"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-2)"},children:[(0,i.jsx)(r.Z,{size:18,strokeWidth:1.5,"aria-hidden":!0}),(0,i.jsx)("span",{children:m.unit})]}),m.origin?(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-2)"},children:[(0,i.jsx)(n.Z,{size:18,strokeWidth:1.5,"aria-hidden":!0}),(0,i.jsx)("span",{children:m.origin})]}):null,(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-2)"},children:[(0,i.jsx)(l.Z,{size:18,strokeWidth:1.5,"aria-hidden":!0}),(0,i.jsx)("span",{children:function(e){let t=null!=e.impactCo2Grams?e.impactCo2Grams:Math.max(0,Math.round(1e3*e.co2Saved));return t>=1e3?"".concat((t/1e3).toFixed(1)," kg CO2e evites"):"".concat(t," g CO2e evites")}(m)})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-2)"},children:[(0,i.jsx)(o.Z,{size:18,strokeWidth:1.5,"aria-hidden":!0}),(0,i.jsxs)("span",{children:["DLC cible : ",m.dlcDays," jour",m.dlcDays>1?"s":""]})]}),"number"==typeof m.stock?(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-2)"},children:[(0,i.jsx)(d,{size:18,strokeWidth:1.5,"aria-hidden":!0}),(0,i.jsxs)("span",{children:[m.stock," unite",m.stock>1?"s":""," disponibles"]})]}):null]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"var(--space-2)",flexWrap:"wrap"},children:[(0,i.jsx)("button",{className:"btn btn--primary",type:"button",onClick:()=>{var e,t;(0,p.Kc)({id:m.id,name:m.name,quantity:1,priceCents:null!==(t=null!==(e=m.priceCents)&&void 0!==e?e:m.promoPriceCents)&&void 0!==t?t:null}),x.addToCart(m)},disabled:"number"==typeof m.stock&&m.stock<=0,"aria-disabled":"number"==typeof m.stock&&m.stock<=0,children:"number"==typeof m.stock&&m.stock<=0?"Rupture":"Ajouter au panier"}),(0,i.jsx)("button",{className:"btn btn--secondary",type:"button",onClick:x.openCart,children:"Voir mon panier"})]})]})]})]})}),(0,i.jsx)(b,{productId:m.id,initialReviews:g,totalReviews:v,onRequireAuth:x.openAuthModal})]})}function N(e){let{product:t,reviews:s,reviewsTotal:a}=e;return(0,i.jsx)(k.Z,{children:e=>(0,i.jsx)(C,{product:t,reviews:s,reviewsTotal:a,experience:e})})}},3627:function(e,t,s){"use strict";s.d(t,{O:function(){return a},XU:function(){return r},g8:function(){return n},i0:function(){return l},qB:function(){return o}});var i=s(9116);async function a(e){var t,s;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=await (0,i.S)("/reviews/product/".concat(e),{params:{limit:null!==(t=a.limit)&&void 0!==t?t:20,offset:null!==(s=a.offset)&&void 0!==s?s:0}});return{items:r.items.map(c),total:r.total,limit:r.limit,offset:r.offset}}async function r(e,t){var s,a;return c(await (0,i.S)("/reviews",{method:"POST",body:JSON.stringify({product_id:e.product_id,rating:e.rating,comment:null!==(s=e.comment)&&void 0!==s?s:null,order_id:null!==(a=e.order_id)&&void 0!==a?a:null}),authToken:t}))}async function n(e,t,s){var a,r;return c(await (0,i.S)("/reviews/".concat(e),{method:"PATCH",body:JSON.stringify({product_id:t.product_id,rating:t.rating,comment:null!==(a=t.comment)&&void 0!==a?a:null,order_id:null!==(r=t.order_id)&&void 0!==r?r:null}),authToken:s}))}async function l(e,t){await (0,i.S)("/reviews/".concat(e),{method:"DELETE",authToken:t})}async function o(e){var t,s;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=await (0,i.S)("/reviews/me",{authToken:e,params:{limit:null!==(t=a.limit)&&void 0!==t?t:20,offset:null!==(s=a.offset)&&void 0!==s?s:0}});return{items:r.items.map(c),total:r.total,limit:r.limit,offset:r.offset}}function c(e){return{id:e.id,productId:e.product_id,userId:e.user_id,rating:e.rating,comment:e.comment,status:e.status,createdAt:e.created_at,publishedAt:e.published_at,moderationNotes:e.moderation_notes}}},5176:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});let i=(0,s(6471).Z)("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]])}},function(e){e.O(0,[972,697,741,971,117,744],function(){return e(e.s=8406)}),_N_E=e.O()}]);