"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[741],{3404:function(e,t,a){a.d(t,{Z:function(){return s}});var n=a(7437),r=a(2265),i=a(4887);function s(e){let{isOpen:t,onClose:a,title:s,children:l,actions:o}=e,c=(0,r.useId)(),u=(0,r.useRef)(null),d=(0,r.useRef)(null),[p,m]=(0,r.useState)(null),h=(0,r.useCallback)(e=>{"Escape"===e.key&&(e.preventDefault(),a())},[a]);if((0,r.useEffect)(()=>{if(t)return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[t,h]),(0,r.useEffect)(()=>{if(!t)return;let e=u.current;if(!e)return;let a=Array.from(e.querySelectorAll('a[href],button,textarea,input[type="text"],input[type="radio"],input[type="checkbox"],select')).filter(e=>!e.hasAttribute("disabled")),n=d.current||a[0];null==n||n.focus();let r=e=>{if("Tab"!==e.key||0===a.length)return;let t=a[0],n=a[a.length-1];e.shiftKey?document.activeElement===t&&(e.preventDefault(),n.focus()):document.activeElement===n&&(e.preventDefault(),t.focus())};return e.addEventListener("keydown",r),()=>e.removeEventListener("keydown",r)},[t]),(0,r.useEffect)(()=>{if("undefined"==typeof document||p)return;let e=document.getElementById("greencart-modal-root");e||((e=document.createElement("div")).id="greencart-modal-root",document.body.appendChild(e));let t=document.createElement("div");e.appendChild(t),m(t)},[p]),!t||!p)return null;let f=(0,n.jsx)("div",{className:"modal is-open",role:"dialog","aria-modal":"true","aria-labelledby":c,onClick:a,children:(0,n.jsxs)("div",{className:"modal__panel",ref:u,onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("header",{className:"modal__header",children:[(0,n.jsx)("h3",{id:c,children:s}),(0,n.jsx)("button",{className:"modal__close",type:"button",onClick:a,"aria-label":"Fermer la fenetre",ref:d,children:"X"})]}),(0,n.jsx)("div",{children:l}),o?(0,n.jsx)("div",{className:"modal__actions",children:o}):null]})});return(0,i.createPortal)(f,p)}},1741:function(e,t,a){a.d(t,{Z:function(){return V}});var n=a(7437),r=a(2265),i=a(9376),s=a(4730),l=a(8822),o=a(2139),c=a(9116);async function u(e){return(0,c.S)("/cart",{authToken:e})}async function d(e,t){return(0,c.S)("/cart",{method:"PUT",authToken:e,body:JSON.stringify(t.map(e=>({product_id:e.productId,quantity:e.quantity})))})}async function p(e){await (0,c.S)("/cart",{method:"DELETE",authToken:e})}var m=a(2755);async function h(e,t){return(0,c.S)("/payments/init",{method:"POST",authToken:e,body:JSON.stringify(t)})}let f={category:"",region:"",availability:"",query:"",priceMin:null,priceMax:null,dlcMaxDays:null,sort:"newest"},g={orders:0,co2:0,savings:0,weeklySavings:0},y=(e,t)=>{let a=new Set(e);return t.forEach(e=>{e&&a.add(e)}),Array.from(a).sort((e,t)=>e.localeCompare(t,"fr",{sensitivity:"base"}))},v=e=>"number"==typeof e&&Number.isFinite(e)?e:void 0,x=e=>""!==e.availability,b=(e,t)=>{let a=x(e);return{query:e.query||void 0,category:e.category||void 0,region:e.region||void 0,dlcWithinDays:v(e.dlcMaxDays),priceMin:v(e.priceMin),priceMax:v(e.priceMax),limit:a?100:12,offset:a?0:(t-1)*12,sort:e.sort}},j=e=>e.reduce((e,t)=>(e.totalPrice+=t.price*t.quantity,e.totalCo2+=t.co2Saved*t.quantity,e),{totalPrice:0,totalCo2:0}),C=()=>"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"order-".concat(Date.now(),"-").concat(Math.random());var k=a(3404);let w={email:"",password:"",firstName:"",lastName:"",region:"",role:"consumer",consentNewsletter:!1,consentAnalytics:!1};function _(e){let{mode:t,isOpen:a,onClose:i}=e,{login:l,register:o}=(0,s.a)(),[c,u]=(0,r.useState)(w),[d,p]=(0,r.useState)(null),[m,h]=(0,r.useState)(!1);(0,r.useEffect)(()=>{a&&(u(e=>({...w,role:e.role})),p(null),h(!1))},[a,t]);let f=async e=>{e.preventDefault(),h(!0),p(null);let{email:a,password:n,firstName:r,lastName:s,region:l,role:o,consentAnalytics:u,consentNewsletter:d}=c;try{if("login"===t){let e=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:n})}),t=await e.json();if(!e.ok){console.log(t.error||"Erreur de connexion");return}localStorage.setItem("token",t.token),console.log("Connexion r\xe9ussie !"),window.location.href="/"}else{console.log("Registering user:",c);let e=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:n,firstName:r,lastName:s,region:l,role:o,consentNewsletter:d,consentAnalytics:u})}),t=await e.json();if(!e.ok){console.log(t.error||"Erreur \xe0 l'inscription");return}console.log("Inscription r\xe9ussie",t),window.location.href="/"}i()}finally{h(!1)}},g=(e,t)=>{u(a=>({...a,[e]:t}))};return a?(0,n.jsx)(k.Z,{isOpen:a,onClose:i,title:"login"===t?"Se connecter":"Creer un compte",children:(0,n.jsxs)("form",{className:"grid",onSubmit:f,style:{gap:"var(--space-3)"},children:["register"===t?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"grid",style:{gap:"var(--space-2)"},children:[(0,n.jsxs)("label",{className:"input-label",children:["Prenom",(0,n.jsx)("input",{className:"input",placeholder:"Prenom",value:c.firstName,onChange:e=>g("firstName",e.target.value)})]}),(0,n.jsxs)("label",{className:"input-label",children:["Nom",(0,n.jsx)("input",{className:"input",placeholder:"Nom",value:c.lastName,onChange:e=>g("lastName",e.target.value)})]})]}),(0,n.jsxs)("label",{className:"input-label",children:["Region",(0,n.jsx)("input",{className:"input",placeholder:"Region (ex: Ile-de-France)",value:c.region,onChange:e=>g("region",e.target.value)})]}),(0,n.jsxs)("label",{className:"input-label",children:["Type de compte",(0,n.jsxs)("select",{className:"select",value:c.role,onChange:e=>g("role",e.target.value),required:!0,children:[(0,n.jsx)("option",{value:"consumer",children:"Consommateur"}),(0,n.jsx)("option",{value:"producer",children:"Producteur"})]})]})]}):null,(0,n.jsxs)("label",{className:"input-label",children:["Email",(0,n.jsx)("input",{className:"input",type:"email",value:c.email,onChange:e=>g("email",e.target.value),required:!0,autoComplete:"email"})]}),(0,n.jsxs)("label",{className:"input-label",children:["Mot de passe",(0,n.jsx)("input",{className:"input",type:"password",value:c.password,onChange:e=>g("password",e.target.value),required:!0,minLength:8,autoComplete:"login"===t?"current-password":"new-password"})]}),"register"===t?(0,n.jsxs)("div",{className:"grid",style:{gap:"var(--space-2)"},children:[(0,n.jsxs)("label",{className:"checkbox",children:[(0,n.jsx)("input",{type:"checkbox",checked:c.consentNewsletter,onChange:e=>g("consentNewsletter",e.target.checked)}),(0,n.jsx)("span",{children:"Recevoir les actualites GreenCart"})]}),(0,n.jsxs)("label",{className:"checkbox",children:[(0,n.jsx)("input",{type:"checkbox",checked:c.consentAnalytics,onChange:e=>g("consentAnalytics",e.target.checked)}),(0,n.jsx)("span",{children:"Partager mes donnees d'usage pour le suivi d'impact"})]})]}):null,d?(0,n.jsx)("p",{style:{color:"var(--danger-500, #c43d3d)",margin:0,fontSize:"var(--fs-small)"},children:d}):null,(0,n.jsx)("button",{className:"btn btn--primary",type:"submit",disabled:m,children:m?"Veuillez patienter...":"login"===t?"Se connecter":"Creer mon compte"})]})}):null}var N=a(5490),S=a(9626),E=a(6111),A=a(7238);function q(e){let{isOpen:t,onClose:a,items:r,totalPrice:i,totalCo2:s,onDecrease:l,onIncrease:o,onRemove:c,onEmpty:u,onCheckout:d,isProcessing:p=!1,errorMessage:m=null}=e;return(0,n.jsxs)(k.Z,{isOpen:t,onClose:a,title:"Mon panier",actions:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"btn",type:"button",onClick:a,children:"Continuer mes achats"}),(0,n.jsx)("button",{className:"btn btn--primary",type:"button",onClick:d,disabled:0===r.length||p,children:p?"Traitement...":"Passer au paiement"})]}),children:[m?(0,n.jsx)("div",{className:"alert alert--warning",role:"status",children:m}):null,(0,n.jsxs)("div",{className:"cart-summary",children:[(0,n.jsxs)("strong",{children:["Total : ",i.toFixed(2)," EUR"]}),(0,n.jsx)("button",{className:"btn btn--ghost",type:"button",onClick:u,children:"Vider"})]}),(0,n.jsx)("div",{className:"cart-list",children:0===r.length?(0,n.jsx)("p",{className:"muted",children:"Votre panier est vide pour l'instant."}):r.map(e=>(0,n.jsxs)("article",{className:"cart-item",children:[(0,n.jsxs)("div",{className:"cart-item__header",children:[(0,n.jsx)("strong",{children:e.name}),(0,n.jsxs)("span",{className:"muted",children:[e.region," - ",e.unit]})]}),(0,n.jsxs)("div",{className:"cart-item__controls",children:[(0,n.jsxs)("div",{className:"cart-item__quantity",children:[(0,n.jsx)("button",{className:"btn btn--ghost",type:"button",onClick:()=>l(e.id),"aria-label":"Diminuer la quantite",children:(0,n.jsx)(N.Z,{size:16,strokeWidth:1.5,"aria-hidden":!0})}),(0,n.jsxs)("span",{children:[e.quantity," x ",e.price.toFixed(2)," EUR"]}),(0,n.jsx)("button",{className:"btn btn--ghost",type:"button",onClick:()=>o(e.id),"aria-label":"Augmenter la quantite",children:(0,n.jsx)(S.Z,{size:16,strokeWidth:1.5,"aria-hidden":!0})})]}),(0,n.jsxs)("button",{className:"btn btn--danger",type:"button",onClick:()=>c(e.id),children:[(0,n.jsx)(E.Z,{size:16,strokeWidth:1.5,"aria-hidden":!0}),"Retirer"]})]}),(0,n.jsxs)("div",{className:"cart-item__impact",children:[(0,n.jsx)(A.Z,{size:16,strokeWidth:1.5,"aria-hidden":!0}),(0,n.jsxs)("span",{children:["Impact evite : ",(e.co2Saved*e.quantity).toFixed(1)," kg CO2e"]})]})]},e.id))}),(0,n.jsxs)("div",{className:"cart-footer",children:[(0,n.jsxs)("span",{className:"muted",children:["Total CO2e evite : ",s.toFixed(1)," kg"]}),(0,n.jsx)("span",{className:"muted",children:"Livraison responsable incluse (demo)"})]})]})}var P=a(3145),T=a(7648);function I(){let e=new Date().getFullYear();return(0,n.jsxs)("footer",{className:"site-footer",role:"contentinfo",children:[(0,n.jsxs)("div",{className:"container footer-grid",children:[(0,n.jsxs)("section",{"aria-label":"A propos",children:[(0,n.jsxs)("div",{className:"brand",style:{marginBottom:"10px"},children:[(0,n.jsx)(P.default,{src:"/images/logo.png",alt:"Logo GreenCart",className:"logo",width:44,height:44}),(0,n.jsx)("strong",{children:"GreenCart"})]}),(0,n.jsx)("p",{className:"muted",children:"Plateforme sobre qui relie producteurs engages et foyers responsables, avec un suivi d'impact en temps reel."}),(0,n.jsxs)("ul",{"aria-label":"Reseaux sociaux",style:{display:"flex",gap:"10px",listStyle:"none",padding:0,margin:"10px 0 0"},children:[(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:"https://twitter.com","aria-label":"X (Twitter)",children:"X"})}),(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:"https://instagram.com","aria-label":"Instagram",children:"Instagram"})}),(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:"https://linkedin.com","aria-label":"LinkedIn",children:"LinkedIn"})})]})]}),(0,n.jsxs)("section",{"aria-label":"Navigation",children:[(0,n.jsx)("strong",{children:"Navigation"}),(0,n.jsxs)("ul",{className:"footer-links",children:[(0,n.jsx)("li",{children:(0,n.jsx)(T.default,{href:{pathname:"/",hash:"marque"},children:"Plateforme de marque"})}),(0,n.jsx)("li",{children:(0,n.jsx)(T.default,{href:"/catalogue",children:"Catalogue"})}),(0,n.jsx)("li",{children:(0,n.jsx)(T.default,{href:{pathname:"/",hash:"dashboard"},children:"Mon impact"})}),(0,n.jsx)("li",{children:(0,n.jsx)(T.default,{href:"/producteurs",children:"Espace producteur"})}),(0,n.jsx)("li",{children:(0,n.jsx)(T.default,{href:"/aide",children:"Aide & FAQ"})})]})]}),(0,n.jsxs)("section",{"aria-label":"Mentions legales",children:[(0,n.jsx)("strong",{children:"Legal"}),(0,n.jsxs)("ul",{className:"footer-links",children:[(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:"#",children:"Mentions legales"})}),(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:"#",children:"Conditions d'utilisation"})}),(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:"#",children:"Politique de confidentialite"})}),(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:"#",children:"Cookies"})})]})]}),(0,n.jsxs)("section",{"aria-label":"Contact",children:[(0,n.jsx)("strong",{children:"Contact"}),(0,n.jsxs)("address",{style:{fontStyle:"normal"},children:[(0,n.jsx)("a",{href:"mailto:hello@greencart.local",children:"hello@greencart.local"}),(0,n.jsx)("br",{}),"Ile-de-France, France"]}),(0,n.jsx)("p",{className:"muted",children:"Support du lundi au vendredi - 9h-18h."})]})]}),(0,n.jsxs)("div",{className:"container footer-bottom",children:[(0,n.jsxs)("span",{children:["(c) ",e," GreenCart. Tous droits reserves."]}),(0,n.jsx)("span",{children:"SIREN 000 000 000 - Demonstration."})]})]})}var M=a(4986),D=a(6818),O=a(257);let F={consumer:"Consommateur",producer:"Producteur",admin:"Admin"},L=[{label:"Accueil",href:"/"},{label:"Valeurs",href:"/valeurs"},{label:"Catalogue",href:"/catalogue"},{label:"Producteurs",href:"/producteurs"},{label:"Aide",href:"/aide"}],R={consumer:[{label:"Compte",href:"/compte"},{label:"Avis",href:"/compte/avis"},{label:"Commandes",href:"/compte/commandes"},{label:"Impact",href:"/compte/impact"},{label:"Aide",href:"/aide"}],producer:[{label:"Dashboard",href:"/producteurs/dashboard"},{label:"Mes produits",href:"/producteurs/produits"},{label:"Commandes",href:"/producteurs/commandes"},{label:"Recommandations IA",href:"/producteurs/recommandations"},{label:"Aide",href:"/aide"}],admin:[{label:"Analytics",href:"/admin/analytics"},{label:"BI",href:"/admin/bi"},{label:"Donn\xe9es publiques",href:"/admin/public-data"},{label:"Rapports",href:"/admin/reports"},{label:"Utilisateurs",href:"/admin/utilisateurs"}]};function Z(e){let{cartCount:t,onOpenCart:a,onOpenLogin:i,onOpenRegister:s,onLogout:l,user:o,isAuthenticating:c,isScrolled:u}=e,[d,p]=(0,r.useState)(!1),m=(0,r.useMemo)(()=>{var e;return o&&o.role&&null!==(e=R[o.role])&&void 0!==e?e:[]},[o]),h=(0,r.useMemo)(()=>(null==o?void 0:o.role)==="admin"||(null==o?void 0:o.role)==="producer"||(null==o?void 0:o.role)==="consumer"?m:[...L,...m],[o,m]),f=()=>{p(!1)},g=async()=>{try{localStorage.removeItem("token"),window.location.href="/"}catch(e){console.error("Erreur lors de l'appel logout",e)}},[y,v]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=localStorage.getItem("token");if(!e){console.log("Aucun token trouv\xe9");return}console.log("JWT_SECRET =",O.env.JWT_SECRET),(async()=>{try{let t=await fetch("/api/auth/me",{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}),a=await t.text();if(console.log("Status /api/auth/me :",t.status,a),!t.ok)return;let n=JSON.parse(a);v(n.user),console.log("Utilisateur r\xe9cup\xe9r\xe9 :",n.user)}catch(e){console.error("Erreur r\xe9cup\xe9ration utilisateur :",e)}})()},[]),(0,n.jsx)("header",{className:"site-header".concat(u?" is-scrolled":""),children:(0,n.jsxs)("div",{className:"container nav",children:[(0,n.jsxs)("div",{className:"brand",children:[(0,n.jsx)(P.default,{src:"/images/logo.png",alt:"Logo GreenCart",className:"logo",width:44,height:44}),(0,n.jsx)(T.default,{href:"/",className:"brand-name",onClick:f,children:"GreenCart"}),(0,n.jsx)("span",{className:"muted",style:{fontSize:"var(--fs-small)"}})]}),(0,n.jsxs)("button",{className:"header-toggle",type:"button","aria-expanded":d,"aria-controls":"navigation-principale",onClick:()=>{p(e=>!e)},children:[d?(0,n.jsx)(M.Z,{size:22,strokeWidth:1.5,"aria-hidden":!0}):(0,n.jsx)(D.Z,{size:22,strokeWidth:1.5,"aria-hidden":!0}),(0,n.jsx)("span",{className:"sr-only",children:d?"Fermer le menu":"Ouvrir le menu"})]}),(0,n.jsxs)("div",{className:"header-menus".concat(d?" is-open":""),children:[(0,n.jsx)("nav",{id:"navigation-principale",className:"navlinks",role:"navigation","aria-label":"Navigation principale",children:h.map(e=>(0,n.jsx)(T.default,{href:e.href,onClick:f,children:e.label},e.label))}),y?(0,n.jsx)("div",{className:"nav-actions",children:(0,n.jsxs)("div",{style:{display:"flex",gap:"var(--space-2)",alignItems:"center",flexWrap:"wrap",margin:"auto"},children:[(0,n.jsxs)("button",{className:"btn btn--ghost",type:"button",onClick:()=>{a(),f()},children:["Mon panier (",t,")"]}),(0,n.jsxs)("p",{style:{color:"green",fontWeight:"bold"},children:[" ",y.firstName," ",y.lastName]}),(0,n.jsx)("button",{onClick:g,className:"btn btn--primary",type:"button",children:"Se deconnecter"})]})}):(0,n.jsxs)("div",{className:"nav-actions",children:[(null==o?void 0:o.role)!=="consumer"&&o?null:(0,n.jsxs)("button",{className:"btn btn--ghost",type:"button",onClick:()=>{a(),f()},children:["Mon panier (",t,")"]}),o?(0,n.jsxs)("div",{style:{display:"flex",gap:"var(--space-2)",alignItems:"center",flexWrap:"wrap"},children:[(0,n.jsx)("div",{className:"badge badge--ghost",children:F[o.role]}),(0,n.jsx)("span",{className:"muted",style:{fontSize:"var(--fs-small)"},children:[o.firstName,o.lastName].filter(Boolean).join(" ").trim()||o.email}),(0,n.jsx)("button",{className:"btn btn--ghost",type:"button",onClick:()=>{null==l||l(),f()},disabled:c,children:c?"Chargement...":"Se deconnecter"})]}):(0,n.jsxs)("div",{style:{display:"flex",gap:"var(--space-2)",flexWrap:"wrap",alignItems:"center"},children:[(0,n.jsx)("button",{className:"btn btn--ghost",type:"button",onClick:()=>{i(),f()},children:"Se connecter"}),(0,n.jsx)("button",{className:"btn btn--primary",type:"button",onClick:()=>{s(),f()},children:"Creer un compte"})]})]})]})]})})}var z=a(7010),U=a(8012),W=a(850);function G(e){var t;let{product:a,afterDescription:r}=e,i=(t=a.dlcDays)<=3?"DLC proche : planifiez votre consommation.":t<=7?"A consommer dans la semaine.":"DLC confortable pour vos menus a venir.";return(0,n.jsxs)("div",{style:{display:"grid",gap:"var(--space-4)"},children:[(0,n.jsx)(P.default,{src:a.image,alt:a.name,width:680,height:420,sizes:"(max-width: 900px) 90vw, 640px",style:{width:"100%",height:"auto",borderRadius:"var(--radius-lg)",border:"1px solid var(--gc-border)",objectFit:"cover"},priority:!0}),(0,n.jsxs)("div",{className:"grid",style:{gap:"var(--space-3)"},children:[(0,n.jsxs)("div",{className:"meta",style:{display:"flex",gap:"var(--space-4)",flexWrap:"wrap"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-2)"},children:[(0,n.jsx)(z.Z,{size:18,strokeWidth:1.5,"aria-hidden":!0}),(0,n.jsx)("span",{children:a.unit})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-2)"},children:[(0,n.jsx)(U.Z,{size:18,strokeWidth:1.5,"aria-hidden":!0}),(0,n.jsx)("span",{children:a.region})]})]}),(0,n.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"var(--space-3)"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-2)"},children:[(0,n.jsx)(A.Z,{size:18,strokeWidth:1.5,"aria-hidden":!0}),(0,n.jsxs)("strong",{children:[a.co2Saved.toFixed(1)," kg CO2e evites"]})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-2)"},children:[(0,n.jsx)(W.Z,{size:18,strokeWidth:1.5,"aria-hidden":!0}),(0,n.jsxs)("span",{children:["DLC ",a.dlcDays," jours"]})]})]}),(0,n.jsxs)("div",{className:"alert alert--warning",role:"status",children:[(0,n.jsx)(W.Z,{size:18,strokeWidth:1.5,"aria-hidden":!0}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{style:{display:"block"},children:"Conseil anti-gaspi"}),(0,n.jsx)("span",{children:i})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("strong",{children:[a.price.toFixed(2)," EUR"]}),(0,n.jsx)("p",{className:"muted",style:{marginTop:"var(--space-2)"},children:a.description})]}),r]})]})}function B(e){let{product:t,isOpen:a,onClose:r,onAddToCart:i}=e;if(!t)return null;let s="number"==typeof t.stock&&t.stock<=0;return(0,n.jsx)(k.Z,{isOpen:a,onClose:r,title:t.name,actions:(0,n.jsx)("button",{className:"btn btn--primary",type:"button",disabled:s,"aria-disabled":s,onClick:()=>{s||i(t)},children:s?"Rupture":"Ajouter au panier"}),children:(0,n.jsx)(G,{product:t})})}var J=a(4033);function V(e){let{children:t,initialFilters:c,requireAuth:v=!1,requiredRole:k}=e,w=function(e){let{user:t}=(0,s.a)(),n=!!t,c=(0,i.useRouter)(),[v,k]=(0,r.useState)({...f,...null!=e?e:{}}),[w,_]=(0,r.useState)(1),[N,S]=(0,r.useState)([]),[E,A]=(0,r.useState)([]),[q,P]=(0,r.useState)(0),[T,I]=(0,r.useState)([]),[M,D]=(0,r.useState)([]),[O,F]=(0,r.useState)(!1),[L,R]=(0,r.useState)([]),[Z,z]=(0,r.useState)(()=>j([])),[U,W]=(0,r.useState)(!1),[G,B]=(0,r.useState)(null),[J,V]=(0,r.useState)(null),[X,H]=(0,r.useState)(!1),[K,Y]=(0,r.useState)(null),[Q,$]=(0,r.useState)(g),ee=(0,r.useRef)(new Map),et=(0,r.useRef)([]),ea=(0,r.useRef)(0),[en,er]=(0,r.useState)(null);(0,r.useEffect)(()=>{et.current=L},[L]),(0,r.useEffect)(()=>{k({...f,...null!=e?e:{}}),_(1)},[e]);let ei=(0,r.useCallback)(async e=>{let t=ee.current.get(e);if(t)return t;try{let t=await (0,o.dQ)(e);if(t)return ee.current.set(t.id,t),t}catch(e){console.error("[useShoppingExperience] Failed to fetch product",e)}return null},[]),es=(0,r.useCallback)(async e=>{var t;return{...null!==(t=await ei(e.product_id))&&void 0!==t?t:{id:e.product_id,slug:String(e.product_id),name:e.product_title,price:e.unit_price_cents/100,region:"France",category:"Produit",availability:"normal",co2Saved:0,dlcDays:0,unit:"Unite",image:"https://images.unsplash.com/photo-1504674900247-0877df9cc836?q=80&w=1200&auto=format&fit=crop",description:""},price:e.unit_price_cents/100,priceCents:e.unit_price_cents,quantity:e.quantity}},[ei]),el=(0,r.useCallback)(e=>{I(t=>y(t,e.map(e=>e.category))),D(t=>y(t,e.map(e=>e.region)))},[]),eo=(0,r.useCallback)(async(e,t)=>{F(!0);try{let a=b(e,t),n=await (0,o.t2)(a);el(n.items);let r=e.availability&&e.availability.length>0?n.items.filter(t=>t.availability===e.availability):n.items,i=x(e)?r.slice((t-1)*12,12*t):r;S(i),A(r),P(x(e)?r.length:n.total)}catch(e){console.error("[useShoppingExperience] Failed to fetch products",e),S([]),A([]),P(0)}finally{F(!1)}},[el]);(0,r.useEffect)(()=>{eo(v,w)},[v,w,eo]);let ec=(0,r.useMemo)(()=>E.filter(e=>"surplus"===e.availability).slice(0,3),[E]),eu=(0,r.useMemo)(()=>E.reduce((e,t)=>e+t.co2Saved,0),[E]),ed=(0,r.useMemo)(()=>3*E.reduce((e,t)=>e+t.price,0),[E]),ep=(0,r.useMemo)(()=>L.reduce((e,t)=>e+t.quantity,0),[L]),em=(0,r.useCallback)(async()=>{let e=(0,l.Z6)();if(!e){z(j(et.current));return}let t=++ea.current;W(!0),B(null);try{let a=await u(e.accessToken),n=await Promise.all(a.items.map(es));if(ea.current!==t)return;R(n),z({totalPrice:a.total_amount_cents/100,totalCo2:j(n).totalCo2})}catch(e){if(ea.current!==t)return;console.error("[useShoppingExperience] Failed to load cart",e),B("Impossible de synchroniser le panier. Vos ajouts restent locaux."),z(j(et.current))}finally{ea.current===t&&W(!1)}},[es]),eh=(0,r.useCallback)(async(e,t)=>{let a=(0,l.Z6)();if(!a){z(t);return}let n=++ea.current;W(!0),B(null);try{let t=await d(a.accessToken,e.map(e=>({productId:e.id,quantity:e.quantity})));if(ea.current!==n)return;let r=await Promise.all(t.items.map(es));R(r),z({totalPrice:t.total_amount_cents/100,totalCo2:j(r).totalCo2})}catch(r){if(ea.current!==n)return;console.error("[useShoppingExperience] Failed to sync cart",r);let a=r&&"object"==typeof r&&"payload"in r&&r.payload&&"object"==typeof r.payload&&"detail"in r.payload?r.payload.detail:null;B("string"==typeof a?a:"Synchronisation du panier impossible. Vos modifications restent locales."),z(t),R(e)}finally{ea.current===n&&W(!1)}},[es]);(0,r.useEffect)(()=>{n?em():z(j(et.current))},[n,em]);let ef=(0,r.useCallback)(e=>{R(t=>{let a=e(t),r=j(a);return er(null),z(r),n&&eh(a,r),a})},[n,eh]),eg=(0,r.useCallback)(e=>{ef(t=>t.find(t=>t.id===e.id)?t.map(t=>t.id===e.id?{...t,quantity:t.quantity+1}:t):[...t,{...e,quantity:1}])},[ef]),ey=(0,r.useCallback)(e=>{ef(t=>t.map(t=>t.id===e?{...t,quantity:t.quantity-1}:t).filter(e=>e.quantity>0))},[ef]),ev=(0,r.useCallback)(e=>{ef(t=>t.map(t=>t.id===e?{...t,quantity:t.quantity+1}:t))},[ef]),ex=(0,r.useCallback)(e=>{ef(t=>t.filter(t=>t.id!==e))},[ef]),eb=(0,r.useCallback)(()=>{if(ef(()=>[]),n){let e=(0,l.Z6)();e&&p(e.accessToken)}},[ef,n]),ej=(0,r.useCallback)(()=>{H(!0)},[]),eC=(0,r.useCallback)(()=>{H(!1)},[]),ek=(0,r.useCallback)(e=>{V(e)},[]),ew=(0,r.useCallback)(()=>{V(null)},[]),e_=(0,r.useCallback)(()=>{if(0===et.current.length)return;if(!n){Y("login");return}let e=(0,l.Z6)();if(!e){Y("login");return}let t={items:et.current.map(e=>({product_id:e.id,quantity:e.quantity}))};er(null),W(!0),B(null),(0,m.LV)(e.accessToken,t,C()).then(async t=>{try{let a=window.location.origin,n=await h(e.accessToken,{order_id:t.id,provider:"stripe",success_url:"".concat(a,"/payment/success"),cancel_url:"".concat(a,"/payment/cancel")});window.location.href=n.checkout_url;return}catch(e){console.warn("[useShoppingExperience] Stripe init failed, falling back to manual flow",e)}R([]),z({totalPrice:0,totalCo2:0}),$(e=>({orders:e.orders+1,co2:e.co2+t.totalImpactCo2Grams/1e3,savings:e.savings+t.totalAmountCents/100,weeklySavings:e.weeklySavings})),H(!1),er("Commande #".concat(t.id," validee ! Total ").concat((t.totalAmountCents/100).toFixed(2)," ").concat(t.currency,". Merci pour votre achat."));try{let{trackPurchase:e}=await Promise.resolve().then(a.bind(a,4033));e({orderId:t.id,currency:t.currency,totalCents:t.totalAmountCents})}catch(e){}try{await p(e.accessToken)}catch(e){console.error("[useShoppingExperience] Failed to clear remote cart after order",e),B("Le panier distant n'a pas pu etre nettoye. Actualisez la page si besoin.")}await em();try{c.push("/compte/commandes?order=".concat(t.id,"&success=1"))}catch(e){}}).catch(e=>{console.error("[useShoppingExperience] Checkout failed",e),B("Impossible de finaliser la commande. Merci de reessayer."),er(null)}).finally(()=>{W(!1)})},[n,em]),eN=(0,r.useCallback)(()=>{let e=8+22*Math.random();$(t=>({...t,weeklySavings:t.weeklySavings+e}))},[]),eS=(0,r.useCallback)(e=>{_(1),k(e)},[]);return{filters:v,setFilters:eS,resetFilters:(0,r.useCallback)(()=>{k(f),_(1)},[]),categories:T,regions:M,featuredProducts:ec,filteredProducts:N,totalProducts:q,page:w,pageSize:12,setPage:_,isLoadingProducts:O,cartItems:L,cartCount:ep,cartTotals:Z,isCartSyncing:U,cartError:G,addToCart:eg,decreaseItem:ey,increaseItem:ev,removeItem:ex,emptyCart:eb,isCartOpen:X,openCart:ej,closeCart:eC,selectedProduct:J,openProduct:ek,closeProduct:ew,handleCheckout:e_,metrics:Q,simulateWeek:eN,totalCo2:eu,totalSavings:ed,producersCount:42,authModal:K,openAuthModal:(0,r.useCallback)(e=>{Y(e)},[]),closeAuthModal:(0,r.useCallback)(()=>{Y(null)},[]),checkoutSuccess:en}}(c),N=(0,i.useRouter)(),{user:S,logout:E,isAuthenticating:A}=(0,s.a)(),[P,T]=(0,r.useState)(!1),{authModal:M,closeAuthModal:D}=w;(0,r.useEffect)(()=>{let e=()=>T(window.scrollY>8);return e(),window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)},[]),(0,r.useEffect)(()=>{S&&null!==M&&D()},[S,M,D]),(0,r.useEffect)(()=>{!v||A||S||"login"===M||w.openAuthModal("login")},[v,A,S,M,w]);let O=w.isCartOpen||null!==M||null!==w.selectedProduct;(0,r.useEffect)(()=>{if(!O)return;let{body:e}=document,t=e.style.overflow;return e.style.overflow="hidden",()=>{e.style.overflow=t}},[O]);let F=(0,r.useMemo)(()=>!k||!!S&&(Array.isArray(k)?k:[k]).includes(S.role),[S,k]),L=!A&&v&&(!S||!F);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Z,{cartCount:w.cartCount,onOpenCart:w.openCart,onOpenLogin:()=>w.openAuthModal("login"),onOpenRegister:()=>w.openAuthModal("register"),onLogout:E,isScrolled:P,user:S,isAuthenticating:A}),A?(0,n.jsx)("main",{className:"container",style:{display:"grid",gap:"var(--space-12)"},"aria-busy":"true",children:(0,n.jsx)("section",{className:"section",children:(0,n.jsx)("div",{className:"skeleton-block",style:{height:200}})})}):L?(0,n.jsx)("main",{className:"container",style:{display:"grid",gap:"var(--space-12)"},children:(0,n.jsx)("section",{className:"section",children:(0,n.jsxs)("div",{style:{display:"grid",gap:"var(--space-3)"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"badge badge--impact",children:"Acc\xe8s prot\xe9g\xe9"}),(0,n.jsx)("h1",{style:{marginTop:"var(--space-2)"},children:"Veuillez vous connecter"}),(0,n.jsxs)("p",{className:"muted",children:["Cette section est r\xe9serv\xe9e aux utilisateurs authentifi\xe9s",k?" avec le r\xf4le appropri\xe9":"","."]})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:"var(--space-2)",flexWrap:"wrap"},children:[(0,n.jsx)("button",{className:"btn btn--primary",type:"button",onClick:()=>w.openAuthModal("login"),children:"Se connecter"}),(0,n.jsx)("button",{className:"btn btn--secondary",type:"button",onClick:()=>w.openAuthModal("register"),children:"Cr\xe9er un compte"})]})]})})}):t(w),(0,n.jsx)(I,{}),(0,n.jsx)(q,{isOpen:w.isCartOpen,onClose:w.closeCart,items:w.cartItems,totalPrice:w.cartTotals.totalPrice,totalCo2:w.cartTotals.totalCo2,onDecrease:w.decreaseItem,onIncrease:w.increaseItem,onRemove:w.removeItem,onEmpty:w.emptyCart,onCheckout:()=>{try{let e=w.cartItems.map(e=>{var t;return{id:e.id,quantity:e.quantity,priceCents:null!==(t=e.priceCents)&&void 0!==t?t:null}}),t=Math.round(100*w.cartTotals.totalPrice);(0,J.Z_)({totalCents:t,items:e})}catch(e){}w.closeCart(),N.push("/checkout")},isProcessing:w.isCartSyncing,errorMessage:w.cartError}),(0,n.jsx)(B,{isOpen:null!==w.selectedProduct,product:w.selectedProduct,onClose:w.closeProduct,onAddToCart:e=>{w.addToCart(e),w.closeProduct()}}),(0,n.jsx)(_,{mode:"register"===M?"register":"login",isOpen:null!==M&&!S,onClose:D})]})}},4730:function(e,t,a){a.d(t,{H:function(){return h},a:function(){return f}});var n=a(7437),r=a(2265),i=a(9376),s=a(8822),l=a(9116);async function o(e){let t=await (0,l.S)("/auth/login",{method:"POST",body:JSON.stringify(e)});return(0,s.XC)({accessToken:t.access_token,refreshToken:t.refresh_token}),{user:await d(t.access_token),tokens:{accessToken:t.access_token,refreshToken:t.refresh_token}}}async function c(e){var t,a,n;let r={email:e.email,password:e.password,role:null!==(t=e.role)&&void 0!==t?t:"consumer",first_name:e.firstName,last_name:e.lastName,region:e.region,consent_newsletter:null!==(a=e.consentNewsletter)&&void 0!==a&&a,consent_analytics:null!==(n=e.consentAnalytics)&&void 0!==n&&n};return p(await (0,l.S)("/auth/register",{method:"POST",body:JSON.stringify(r)}))}async function u(e){let t=await (0,l.S)("/auth/refresh",{method:"POST",body:JSON.stringify({refresh_token:e})});return(0,s.XC)({accessToken:t.access_token,refreshToken:t.refresh_token}),{accessToken:t.access_token,refreshToken:t.refresh_token}}async function d(e){return p(await (0,l.S)("/auth/me",{authToken:e}))}function p(e){return{id:e.id,email:e.email,role:e.role,firstName:e.first_name,lastName:e.last_name,region:e.region,isActive:e.is_active,emailVerifiedAt:e.email_verified_at,lastLoginAt:e.last_login_at,consentNewsletter:e.consent_newsletter,consentAnalytics:e.consent_analytics,createdAt:e.created_at,updatedAt:e.updated_at}}let m=(0,r.createContext)(void 0);function h(e){let{children:t}=e,[a,l]=(0,r.useState)(null),[u,d]=(0,r.useState)(!0),p=(0,i.useRouter)();(0,r.useEffect)(()=>{let e=!0;return(async()=>{let t=(0,s.Z6)();if(!t){e&&d(!1);return}try{let a=await g(t);e&&l(a)}catch(t){(0,s.ZP)(),e&&l(null)}finally{e&&d(!1)}})(),()=>{e=!1}},[]);let h=(0,r.useCallback)(async e=>{try{let t=await o(e);return l(t.user),{success:!0}}catch(e){return{success:!1,error:y(e)}}},[]),f=(0,r.useCallback)(async e=>{try{await c(e);let t=await h({email:e.email,password:e.password});if(!t.success)return t;return{success:!0}}catch(e){return{success:!1,error:y(e)}}},[h]),v=(0,r.useCallback)(()=>{(0,s.ZP)(),l(null);try{p.push("/landing")}catch(e){}},[p]),x=(0,r.useCallback)(async()=>{let e=(0,s.Z6)();if(e)try{let t=await g(e);l(t)}catch(e){}},[]),b=(0,r.useMemo)(()=>({user:a,isAuthenticating:u,login:h,register:f,logout:v,reloadUser:x}),[a,u,h,f,v,x]);return(0,n.jsx)(m.Provider,{value:b,children:t})}function f(){let e=(0,r.useContext)(m);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}async function g(e){try{return await d(e.accessToken)}catch(t){return d((await u(e.refreshToken)).accessToken)}}function y(e){if(e&&"object"==typeof e&&"payload"in e){let t=e.payload;if("string"==typeof t)return t;if(t&&"object"==typeof t&&"detail"in t){let e=t.detail;if("string"==typeof e)return e;if(Array.isArray(e)&&e.length>0)return String(e[0])}}return e instanceof Error?e.message:"Une erreur est survenue. Merci de reessayer."}},8439:function(e,t,a){a.d(t,{CB:function(){return r},Hp:function(){return s},as:function(){return l},dU:function(){return i}});let n="greencart_consent_analytics",r="greencart:consent-changed";function i(){let e=window.localStorage.getItem(n);return"granted"===e||"denied"===e?e:null}function s(){return"granted"===i()}function l(e){window.localStorage.setItem(n,e),window.dispatchEvent(new Event(r))}},4033:function(e,t,a){a.d(t,{Kc:function(){return o},Sg:function(){return l},Z_:function(){return c},trackPurchase:function(){return u}});var n=a(8439);let r=new URL("/api/v1/analytics/events",(0,a(9116).r)()).toString();function i(e){return"number"!=typeof e||Number.isNaN(e)?null:e/100}function s(e,t,a){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if((0,n.Hp)())window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:t,greencartEvent:e,timestamp:new Date().toISOString(),...a,...i}),function(e,t,a){let n=JSON.stringify({event_name:e,source:"web_app",properties:{...a,gtm_event:t}});try{if("undefined"!=typeof navigator&&"function"==typeof navigator.sendBeacon){let e=new Blob([n],{type:"application/json"});if(navigator.sendBeacon(r,e))return}}catch(e){}fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:n,keepalive:!0}).catch(()=>{})}(e,t,a)}function l(e){var t,a,n;let r=null!==(t=e.priceCents)&&void 0!==t?t:null,l={product_id:e.id,name:e.name,price_cents:r,category:null!==(a=e.category)&&void 0!==a?a:null,region:null!==(n=e.region)&&void 0!==n?n:null},o=i(r),c=[{item_id:e.id,item_name:e.name,...e.category?{item_category:e.category}:{},...e.region?{item_category2:e.region}:{},...null!==o?{price:o}:{}}];s("view_product","view_item",l,{ecommerce:{currency:"EUR",...null!==o?{value:o}:{},items:c}})}function o(e){var t,a;let n={product_id:e.id,name:e.name,quantity:e.quantity,price_cents:null!==(t=e.priceCents)&&void 0!==t?t:null},r=i(null!==(a=e.priceCents)&&void 0!==a?a:null),l=null!==r?r*e.quantity:null;s("add_to_cart","add_to_cart",n,{ecommerce:{currency:"EUR",...null!==l?{value:l}:{},items:[{item_id:e.id,item_name:e.name,quantity:e.quantity,...null!==r?{price:r}:{}}]}})}function c(e){let t={total_cents:e.totalCents,item_count:e.items.reduce((e,t)=>e+t.quantity,0),items:e.items},a=i(e.totalCents);s("begin_checkout","begin_checkout",t,{ecommerce:{currency:"EUR",...null!==a?{value:a}:{},items:e.items.map(e=>{var t;let a=i(null!==(t=e.priceCents)&&void 0!==t?t:null),n={item_id:e.id,item_name:String(e.id),quantity:e.quantity};return null!==a&&(n.price=a),n})}})}function u(e){var t;let a={order_id:e.orderId,currency:e.currency,value_cents:e.totalCents},n=i(e.totalCents);s("purchase","purchase",a,{ecommerce:{currency:null!==(t=e.currency)&&void 0!==t?t:"EUR",transaction_id:e.orderId,...null!==n?{value:n}:{}}})}},9116:function(e,t,a){a.d(t,{S:function(){return r},r:function(){return s}});let n="http://localhost:8000".replace(/\/+$/,"");async function r(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{params:r,authToken:s,headers:l,next:o,cache:c,...u}=a,d=function(e,t){let a=new URL("".concat("/api/v1").concat(e),n);return t&&Object.entries(t).filter(e=>{let[,t]=e;return null!=t&&""!==t}).forEach(e=>{let[t,n]=e;return a.searchParams.set(t,String(n))}),a}(e,r),p=(null!==(t=u.method)&&void 0!==t?t:"GET").toString().toUpperCase(),m="GET"===p,h=null!=o?o:!s&&m?{revalidate:300}:void 0,f=await fetch(d,{...u,method:p,headers:{"Content-Type":"application/json",...s?{Authorization:"Bearer ".concat(s)}:{},...null!=l?l:{}},cache:null!=c?c:s||!m?"no-store":void 0,...h?{next:h}:{}});if(!f.ok){let e=await i(f),t=Error("API request failed with ".concat(f.status," ").concat(f.statusText));throw t.status=f.status,t.payload=e,t}return await i(f)}async function i(e){let t=await e.text();if(!t)return null;try{return JSON.parse(t)}catch(e){return t}}function s(){return n}},8822:function(e,t,a){a.d(t,{XC:function(){return i},Z6:function(){return s},ZP:function(){return l}});let n="greencart_access_token",r="greencart_refresh_token";function i(e){window.localStorage.setItem(n,e.accessToken),window.localStorage.setItem(r,e.refreshToken)}function s(){let e=window.localStorage.getItem(n),t=window.localStorage.getItem(r);return e&&t?{accessToken:e,refreshToken:t}:null}function l(){window.localStorage.removeItem(n),window.localStorage.removeItem(r)}},2755:function(e,t,a){a.d(t,{AU:function(){return i},G7:function(){return s},LV:function(){return r}});var n=a(9116);async function r(e,t,a){return l(await (0,n.S)("/orders",{method:"POST",authToken:e,body:JSON.stringify(t),headers:{"Idempotency-Key":a}}))}async function i(e){var t,a;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=await (0,n.S)("/orders",{authToken:e,params:{limit:null!==(t=r.limit)&&void 0!==t?t:20,offset:null!==(a=r.offset)&&void 0!==a?a:0}});return{items:i.items.map(l),total:i.total,limit:i.limit,offset:i.offset}}async function s(e,t){return l(await (0,n.S)("/orders/".concat(t),{authToken:e}))}function l(e){return{id:e.id,status:e.status,currency:e.currency,totalAmountCents:e.total_amount_cents,totalItems:e.total_items,totalImpactCo2Grams:e.total_impact_co2_g,paymentReference:e.payment_reference,paymentProvider:e.payment_provider,idempotencyKey:e.idempotency_key,placedAt:e.placed_at,notes:e.notes,createdAt:e.created_at,updatedAt:e.updated_at,lines:e.lines.map(o)}}function o(e){var t;return{id:e.id,productId:e.product_id,productTitle:e.product_title,quantity:e.quantity,unitPriceCents:e.unit_price_cents,referencePriceCents:null!==(t=e.reference_price_cents)&&void 0!==t?t:null,subtotalCents:e.subtotal_cents,impactCo2Grams:e.impact_co2_g,createdAt:e.created_at,updatedAt:e.updated_at}}},2139:function(e,t,a){a.d(t,{dQ:function(){return s},t2:function(){return i},fm:function(){return l}});var n=a(9116);let r=[{id:1,slug:"pommes-moches-5-kg",name:"Pommes moches (5 kg)",price:6.5,region:"Ile-de-France",category:"Fruits",availability:"surplus",co2Saved:2.1,dlcDays:6,unit:"Colis 5 kg",image:"https://images.unsplash.com/photo-1576402187878-974f70c890a5?q=80&w=1200&auto=format&fit=crop",description:"Pommes hors calibre issues d'une recolte locale. Ideales pour compotes, jus et patisseries anti-gaspi."},{id:2,slug:"legumes-varies-b-4-kg",name:"Legumes varies B (4 kg)",price:7.9,region:"Hauts-de-France",category:"Legumes",availability:"surplus",co2Saved:2.9,dlcDays:4,unit:"Panier 4 kg",image:"https://images.unsplash.com/photo-1515542706656-8e6ef17a1521?q=80&w=1200&auto=format&fit=crop",description:"Panier de legumes biscornus recoltes le matin meme. Varietes adapteees aux soupes et poelees familiales."},{id:3,slug:"yaourts-fermiers-x12",name:"Yaourts fermiers (x12)",price:5.5,region:"Bretagne",category:"Cremerie",availability:"normal",co2Saved:.6,dlcDays:3,unit:"Lot x12",image:"https://images.unsplash.com/photo-1551024601-bec78aea704b?q=80&w=1200&auto=format&fit=crop",description:"Yaourts nature au lait entier, texture genereuse. Date courte mais qualite garantie par la ferme."},{id:4,slug:"pains-de-la-veille-x4",name:"Pains de la veille (x4)",price:2,region:"Ile-de-France",category:"Boulangerie",availability:"surplus",co2Saved:1.2,dlcDays:1,unit:"Lot x4",image:"https://images.unsplash.com/photo-1549931319-a545dcf3bc73?q=80&w=1200&auto=format&fit=crop",description:"Pains tradition de la veille, croustillants apres quelques minutes au four. Emballage compostable."},{id:5,slug:"tomates-irregulieres-3-kg",name:"Tomates irregulieres (3 kg)",price:4.9,region:"Provence-Alpes-Cote d'Azur",category:"Legumes",availability:"surplus",co2Saved:2.3,dlcDays:5,unit:"Cagette 3 kg",image:"https://images.unsplash.com/photo-1567306226416-28f0efdc88ce?q=80&w=1200&auto=format&fit=crop",description:"Tomates anciennes aux formes originales. Saveur ensoleillee, parfaites en salade ou en sauce."},{id:6,slug:"fromage-de-chevre-demi-sec",name:"Fromage de chevre demi-sec",price:3.9,region:"Auvergne-Rhone-Alpes",category:"Cremerie",availability:"normal",co2Saved:.4,dlcDays:10,unit:"Unite 250 g",image:"https://images.unsplash.com/photo-1505575972945-2804b5c35f33?q=80&w=1200&auto=format&fit=crop",description:"Fromage de chevre demi-sec affine 10 jours. Gout franc, lait issu d'un elevage extensif."}];async function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={q:e.query,category:e.category,region:e.region,dlc_lte_days:e.dlcWithinDays,price_min:e.priceMin,price_max:e.priceMax,limit:e.limit,offset:e.offset,sort:e.sort};try{let e=await (0,n.S)("/products",{params:t});return{items:e.items.map(l),total:e.total,limit:e.limit,offset:e.offset}}catch(e){return console.warn("[products] falling back to local mock data",e),{items:r,total:r.length,limit:r.length,offset:0}}}async function s(e){try{let t=await (0,n.S)("/products/".concat(e));return l(t)}catch(e){if(e instanceof Error&&"status"in e&&404===e.status)return null;throw e}}function l(e){var t,a,n,r,i,s,l,o,c,u;let d=e.images.length>0?e.images:[],p=null!==(r=null!==(n=null===(t=d.find(e=>e.is_primary))||void 0===t?void 0:t.url)&&void 0!==n?n:null===(a=d[0])||void 0===a?void 0:a.url)&&void 0!==r?r:"https://images.unsplash.com/photo-1504674900247-0877df9cc836?q=80&w=1200&auto=format&fit=crop";return{id:e.id,slug:"".concat(e.id,"-").concat(e.title).trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),name:e.title,price:Math.round(null!==(c=e.promo_price_cents)&&void 0!==c?c:e.price_cents)/100,region:null!==(i=e.region)&&void 0!==i?i:"France",category:null!==(s=e.category)&&void 0!==s?s:"Autres",availability:e.stock>0?"normal":"surplus",co2Saved:null==(u=e.impact_co2_g)?0:Math.max(Math.round(u)/1e3,0),dlcDays:function(e){if(!e)return 0;let t=new Date;return Math.max(Math.ceil((new Date(e).getTime()-t.setHours(0,0,0,0))/864e5),0)}(e.dlc_date),unit:null!==(l=e.origin)&&void 0!==l?l:"Unite",image:p,description:null!==(o=e.description)&&void 0!==o?o:"",images:d.map(e=>({url:e.url,isPrimary:e.is_primary})),origin:e.origin,stock:e.stock,status:e.status,isPublished:e.is_published,impactCo2Grams:e.impact_co2_g,priceCents:e.price_cents,promoPriceCents:e.promo_price_cents}}}}]);