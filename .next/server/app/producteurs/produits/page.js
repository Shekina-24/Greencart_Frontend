(()=>{var e={};e.id=653,e.ids=[653],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8751:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>p,originalPathname:()=>d,pages:()=>u,routeModule:()=>m,tree:()=>c}),s(1630),s(7304),s(8242),s(5866);var r=s(3191),a=s(8716),i=s(7922),l=s.n(i),n=s(5231),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);s.d(t,o);let c=["",{children:["producteurs",{children:["produits",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,1630)),"C:\\New\\Greencart\\Greencart\\app\\producteurs\\produits\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,7304)),"C:\\New\\Greencart\\Greencart\\app\\producteurs\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,8242)),"C:\\New\\Greencart\\Greencart\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],u=["C:\\New\\Greencart\\Greencart\\app\\producteurs\\produits\\page.tsx"],d="/producteurs/produits/page",p={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/producteurs/produits/page",pathname:"/producteurs/produits",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},4832:(e,t,s)=>{Promise.resolve().then(s.bind(s,34))},5303:()=>{},34:(e,t,s)=>{"use strict";s.d(t,{default:()=>x});var r=s(326),a=s(7577),i=s(6226),l=s(8358),n=s(3391),o=s(3584);async function c(e,t){let s=new FormData;s.append("file",e);let r=await fetch(new URL("/api/v1/uploads/image","http://localhost:8000"),{method:"POST",headers:t?{Authorization:`Bearer ${t}`}:void 0,body:s,cache:"no-store"});if(!r.ok)throw Error(`Upload failed: ${r.status}`);return new URL((await r.json()).url,"http://localhost:8000").toString()}var u=s(2531),d=s(1551),p=s(2716);let m={title:"",description:"",category:"",region:"",origin:"",price:"",promoPrice:"",stock:"",impactCo2:"",dlcDate:"",status:"draft",isPublished:!1,images:[]};function g({isOpen:e,onClose:t,onSubmit:s,isSubmitting:l,initialProduct:n,authToken:o}){let[u,p]=(0,a.useState)(()=>(function(e){if(!e)return{...m};let t=e.priceCents??Math.round(100*e.price);return{title:e.name,description:e.description??"",category:e.category??"",region:e.region??"",origin:e.origin??"",price:(t/100).toFixed(2),promoPrice:e.promoPriceCents?(e.promoPriceCents/100).toFixed(2):"",stock:"number"==typeof e.stock?String(e.stock):"",impactCo2:e.impactCo2Grams?String(e.impactCo2Grams):"",dlcDate:"",status:e.status??"draft",isPublished:!!e.isPublished,images:e.images??[]}})(n)),[g,h]=(0,a.useState)(!1),[x,b]=(0,a.useState)(null),y=(e,t)=>{p(s=>({...s,[e]:t}))},v=async e=>{let t=e.target.files?.[0];if(t){if(!o){b("Session expir\xe9e. Reconnectez-vous.");return}h(!0),b(null);try{let e=await c(t,o);p(t=>{let s=[...t.images,{url:e,isPrimary:0===t.images.length}];return{...t,images:s}})}catch(e){console.error("[ProducerProducts] Upload failed",e),b("T\xe9l\xe9versement impossible. R\xe9essayez avec une image plus l\xe9g\xe8re.")}finally{h(!1),e.target.value=""}}},f=e=>{p(t=>{let s=t.images.map((t,s)=>({...t,isPrimary:s===e}));return{...t,images:s}})},j=e=>{p(t=>{let s=t.images.filter((t,s)=>s!==e);return!s.some(e=>e.isPrimary)&&s.length>0&&(s[0]={...s[0],isPrimary:!0}),{...t,images:s}})};return r.jsx(d.Z,{isOpen:e,onClose:t,title:n?"Modifier le produit":"Ajouter un produit",actions:r.jsx("button",{className:"btn btn--primary",type:"submit",form:"producer-product-form",disabled:l,children:l?"Enregistrement...":n?"Mettre \xe0 jour":"Cr\xe9er"}),children:(0,r.jsxs)("form",{id:"producer-product-form",className:"grid",style:{gap:"var(--space-3)"},onSubmit:e=>{e.preventDefault(),s(u,n?.id??null)},children:[(0,r.jsxs)("label",{className:"input-label",children:["Nom du produit",r.jsx("input",{className:"input",value:u.title,onChange:e=>y("title",e.target.value),required:!0})]}),(0,r.jsxs)("label",{className:"input-label",children:["Description",r.jsx("textarea",{className:"textarea",rows:3,value:u.description,onChange:e=>y("description",e.target.value)})]}),(0,r.jsxs)("div",{className:"grid",style:{gap:"var(--space-2)",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))"},children:[(0,r.jsxs)("label",{className:"input-label",children:["Cat\xe9gorie",r.jsx("input",{className:"input",value:u.category,onChange:e=>y("category",e.target.value)})]}),(0,r.jsxs)("label",{className:"input-label",children:["R\xe9gion",r.jsx("input",{className:"input",value:u.region,onChange:e=>y("region",e.target.value)})]}),(0,r.jsxs)("label",{className:"input-label",children:["Origine / Unit\xe9",r.jsx("input",{className:"input",value:u.origin,onChange:e=>y("origin",e.target.value)})]})]}),(0,r.jsxs)("div",{className:"grid",style:{gap:"var(--space-2)",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))"},children:[(0,r.jsxs)("label",{className:"input-label",children:["Prix (EUR)",r.jsx("input",{className:"input",type:"number",min:"0",step:"0.01",value:u.price,onChange:e=>y("price",e.target.value),required:!0})]}),(0,r.jsxs)("label",{className:"input-label",children:["Prix promo (EUR)",r.jsx("input",{className:"input",type:"number",min:"0",step:"0.01",value:u.promoPrice,onChange:e=>y("promoPrice",e.target.value)})]}),(0,r.jsxs)("label",{className:"input-label",children:["Stock",r.jsx("input",{className:"input",type:"number",min:"0",value:u.stock,onChange:e=>y("stock",e.target.value),required:!0})]}),(0,r.jsxs)("label",{className:"input-label",children:["Impact CO2 (g)",r.jsx("input",{className:"input",type:"number",min:"0",value:u.impactCo2,onChange:e=>y("impactCo2",e.target.value)})]})]}),(0,r.jsxs)("div",{className:"grid",style:{gap:"var(--space-2)",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))"},children:[(0,r.jsxs)("label",{className:"input-label",children:["DLC (date limite)",r.jsx("input",{className:"input",type:"date",value:u.dlcDate,onChange:e=>y("dlcDate",e.target.value)})]}),(0,r.jsxs)("label",{className:"input-label",children:["Statut",(0,r.jsxs)("select",{className:"select",value:u.status,onChange:e=>y("status",e.target.value),children:[r.jsx("option",{value:"draft",children:"Brouillon"}),r.jsx("option",{value:"published",children:"Publi\xe9"}),r.jsx("option",{value:"archived",children:"Archiv\xe9"})]})]}),(0,r.jsxs)("label",{className:"checkbox",style:{alignSelf:"flex-end"},children:[r.jsx("input",{type:"checkbox",checked:u.isPublished,onChange:e=>y("isPublished",e.target.checked)}),"Visible dans le catalogue"]})]}),(0,r.jsxs)("div",{className:"grid",style:{gap:"var(--space-2)"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("strong",{children:"Images"}),(0,r.jsxs)("label",{className:"btn btn--ghost",style:{cursor:"pointer"},children:[g?"T\xe9l\xe9versement...":"Ajouter une image",r.jsx("input",{type:"file",accept:"image/*",onChange:v,style:{display:"none"},disabled:g})]})]}),x?r.jsx("div",{className:"alert alert--warning",children:x}):null,0===u.images.length?r.jsx("p",{className:"muted",children:"Ajoutez au moins une image pour mettre en avant votre lot."}):r.jsx("div",{className:"grid",style:{gap:"var(--space-2)"},children:u.images.map((e,t)=>(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid var(--border-muted)",padding:"var(--space-2)",borderRadius:8},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-2)"},children:[r.jsx(i.default,{src:e.url,alt:"Aper\xe7u produit",width:64,height:64,style:{width:64,height:64,objectFit:"cover",borderRadius:6}}),r.jsx("span",{className:"muted",style:{fontSize:"var(--fs-small)"},children:e.isPrimary?"Image principale":"Miniature"})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"var(--space-2)"},children:[e.isPrimary?null:r.jsx("button",{className:"btn btn--ghost",type:"button",onClick:()=>f(t),children:"D\xe9finir principale"}),r.jsx("button",{className:"btn btn--ghost",type:"button",onClick:()=>j(t),children:"Supprimer"})]})]},e.url))})]})]})})}function h(){let{user:e}=(0,l.a)(),{showToast:t}=(0,p.p)(),[s,i]=(0,a.useState)(1),[c,u]=(0,a.useState)([]),[d,m]=(0,a.useState)(0),[h,x]=(0,a.useState)(!1),[b,y]=(0,a.useState)(null),[v,f]=(0,a.useState)(!1),[j,P]=(0,a.useState)(null),[C,N]=(0,a.useState)(!1),S=n.Z6()?.accessToken??null,w=(0,a.useCallback)(()=>{S&&(x(!0),y(null),(0,o.sJ)(S,{limit:10,offset:(s-1)*10}).then(e=>{u(e.items),m(e.total)}).catch(e=>{console.error("[ProducerProducts] Failed to fetch products",e),y("Impossible de r\xe9cup\xe9rer vos produits.")}).finally(()=>x(!1)))},[S,s]),k=Math.max(1,Math.ceil(d/10)),_=e=>{P(e),f(!0)},G=()=>{f(!1),P(null)},q=async(e,s)=>{if(!S){t("Session expir\xe9e. Reconnectez-vous.","warning");return}try{N(!0);let r={title:e.title,description:e.description||null,category:e.category||null,region:e.region||null,origin:e.origin||null,dlcDate:e.dlcDate||null,impactCo2Grams:e.impactCo2?Number(e.impactCo2):null,priceCents:Math.round(100*Number(e.price||0)),promoPriceCents:e.promoPrice?Math.round(100*Number(e.promoPrice)):null,stock:Number(e.stock||0),status:e.status,isPublished:e.isPublished,images:e.images.map(e=>({url:e.url,isPrimary:e.isPrimary}))};s?(await (0,o.et)(S,s,r),t("Produit mis \xe0 jour","success")):(await (0,o.J8)(S,r),t("Produit cr\xe9\xe9 avec succ\xe8s","success")),G(),w()}catch(e){console.error("[ProducerProducts] Submit failed",e),t("Impossible d'enregistrer le produit.","error")}finally{N(!1)}},D=async e=>{if(S&&window.confirm(`Supprimer le produit "${e.name}" ?`))try{await (0,o.ud)(S,e.id),t("Produit supprim\xe9.","success"),w()}catch(e){console.error("[ProducerProducts] Delete failed",e),t("Suppression impossible.","error")}},M=async e=>{if(!S)return;let s=!e.isPublished;try{await (0,o.et)(S,e.id,{isPublished:s,status:s?"published":"draft"}),t(s?"Produit publi\xe9":"Produit masqu\xe9","success"),w()}catch(e){console.error("[ProducerProducts] Toggle publish failed",e),t("Action impossible.","error")}};return(0,r.jsxs)(r.Fragment,{children:[r.jsx("main",{className:"container",style:{display:"grid",gap:"var(--space-12)"},children:r.jsx("section",{className:"section",children:(0,r.jsxs)("div",{style:{display:"grid",gap:"var(--space-3)"},children:[(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"var(--space-2)"},children:[(0,r.jsxs)("div",{children:[r.jsx("div",{className:"badge badge--impact",children:"Espace producteur"}),r.jsx("h1",{style:{marginTop:"var(--space-2)"},children:"Mes produits"}),r.jsx("p",{className:"muted",children:"Publiez et mettez \xe0 jour vos lots en quelques clics."})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"var(--space-2)",flexWrap:"wrap"},children:[r.jsx("button",{className:"btn btn--primary",type:"button",onClick:()=>{P(null),f(!0)},children:"Ajouter un produit"}),r.jsx("span",{className:"muted",style:{alignSelf:"center"},children:h?"Chargement...":`${d} produit${d>1?"s":""}`})]})]}),b?r.jsx("div",{className:"alert alert--warning",children:b}):null,0!==c.length||h?r.jsx("div",{className:"grid",style:{gap:"var(--space-3)"},children:c.map(e=>(0,r.jsxs)("article",{className:"card",style:{display:"grid",gap:"var(--space-2)"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:"var(--space-2)",flexWrap:"wrap"},children:[r.jsx("strong",{children:e.name}),r.jsx("span",{className:"badge",children:e.status??"draft"})]}),(0,r.jsxs)("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:[e.category||"Sans cat\xe9gorie"," \xb7 ",e.region||"R\xe9gion n/d"]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"var(--space-2)",flexWrap:"wrap"},children:[r.jsx("span",{children:"number"==typeof e.priceCents?`${(e.priceCents/100).toFixed(2)} EUR`:`${e.price.toFixed(2)} EUR`}),"number"==typeof e.stock?(0,r.jsxs)("span",{children:["Stock : ",e.stock]}):null,e.isPublished?r.jsx("span",{className:"badge badge--impact",children:"Publi\xe9"}):r.jsx("span",{className:"badge badge--secondary",children:"Masqu\xe9"})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"var(--space-2)",flexWrap:"wrap"},children:[r.jsx("button",{className:"btn btn--ghost",type:"button",onClick:()=>_(e),children:"Modifier"}),r.jsx("button",{className:"btn btn--ghost",type:"button",onClick:()=>M(e),children:e.isPublished?"Masquer":"Publier"}),r.jsx("button",{className:"btn btn--ghost",type:"button",onClick:()=>D(e),children:"Supprimer"})]})]},e.id))}):r.jsx("p",{className:"muted",children:"Commencez par ajouter votre premier produit."}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"var(--space-2)"},children:[r.jsx("button",{className:"btn btn--ghost",type:"button",disabled:s<=1||h,onClick:()=>i(e=>Math.max(1,e-1)),children:"Pr\xe9c\xe9dent"}),(0,r.jsxs)("span",{className:"muted",children:["Page ",s," / ",k]}),r.jsx("button",{className:"btn btn--ghost",type:"button",disabled:s>=k||h,onClick:()=>i(e=>e+1),children:"Suivant"})]})]})})}),r.jsx(g,{isOpen:v,onClose:G,onSubmit:q,isSubmitting:C,initialProduct:j,authToken:S})]})}function x(){return r.jsx(u.Z,{requireAuth:!0,requiredRole:"producer",children:()=>r.jsx(h,{})})}},3584:(e,t,s)=>{"use strict";s.d(t,{J8:()=>l,et:()=>n,sJ:()=>i,ud:()=>o});var r=s(6824),a=s(9571);async function i(e,t={}){let s=await (0,r.S)("/producer/products",{authToken:e,params:{limit:t.limit??20,offset:t.offset??0}});return{items:s.items.map(a.fm),total:s.total,limit:s.limit,offset:s.offset}}async function l(e,t){let s={title:t.title,price_cents:t.priceCents,stock:t.stock,description:t.description??null,category:t.category??null,region:t.region??null,origin:t.origin??null,dlc_date:t.dlcDate??null,impact_co2_g:t.impactCo2Grams??null,promo_price_cents:t.promoPriceCents??null,is_published:t.isPublished??!1,images:(t.images??[]).map(e=>({url:e.url,is_primary:!!e.isPrimary}))};t.status&&(s.status=t.status);let i=await (0,r.S)("/products",{method:"POST",authToken:e,body:JSON.stringify(s)});return(0,a.fm)(i)}async function n(e,t,s){let i={};void 0!==s.title&&(i.title=s.title),void 0!==s.description&&(i.description=s.description),void 0!==s.category&&(i.category=s.category),void 0!==s.region&&(i.region=s.region),void 0!==s.origin&&(i.origin=s.origin),void 0!==s.dlcDate&&(i.dlc_date=s.dlcDate),void 0!==s.impactCo2Grams&&(i.impact_co2_g=s.impactCo2Grams),void 0!==s.priceCents&&(i.price_cents=s.priceCents),void 0!==s.promoPriceCents&&(i.promo_price_cents=s.promoPriceCents),void 0!==s.stock&&(i.stock=s.stock),void 0!==s.status&&(i.status=s.status),void 0!==s.isPublished&&(i.is_published=s.isPublished);let l=await (0,r.S)(`/producer/products/${t}`,{method:"PUT",authToken:e,body:JSON.stringify(i)});return(0,a.fm)(l)}async function o(e,t){await (0,r.S)(`/producer/products/${t}`,{method:"DELETE",authToken:e})}},7304:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a,metadata:()=>r});let r={title:"Espace producteurs | GreenCart",description:"Tableau de bord, produits et recommandations IA pour les producteurs GreenCart."};function a({children:e}){return e}},1630:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l,metadata:()=>i});var r=s(9510);let a=(0,s(8570).createProxy)(String.raw`C:\New\Greencart\Greencart\components\ProducerProductsPage.tsx#default`),i={title:"Mes produits | GreenCart",description:"G\xe9rez vos produits, prix et stocks."};function l(){return r.jsx(a,{})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,772,404,424,526,531],()=>s(8751));module.exports=r})();