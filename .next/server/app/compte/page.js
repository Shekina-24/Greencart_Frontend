(()=>{var e={};e.id=560,e.ids=[560],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3139:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c}),s(3736),s(8242),s(5866);var a=s(3191),r=s(8716),n=s(7922),i=s.n(n),l=s(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["compte",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,3736)),"C:\\New\\Greencart\\Greencart\\app\\compte\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,8242)),"C:\\New\\Greencart\\Greencart\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\New\\Greencart\\Greencart\\app\\compte\\page.tsx"],u="/compte/page",m={require:s,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/compte/page",pathname:"/compte",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},7258:(e,t,s)=>{Promise.resolve().then(s.bind(s,3008))},3008:(e,t,s)=>{"use strict";s.d(t,{default:()=>m});var a=s(326),r=s(7577),n=s(3391),i=s(6824);async function l(e,t){var s;let a={};return void 0!==t.firstName&&(a.first_name=t.firstName),void 0!==t.lastName&&(a.last_name=t.lastName),void 0!==t.region&&(a.region=t.region),void 0!==t.consentNewsletter&&(a.consent_newsletter=t.consentNewsletter),void 0!==t.consentAnalytics&&(a.consent_analytics=t.consentAnalytics),{id:(s=await (0,i.S)("/users/me",{method:"PATCH",authToken:e,body:JSON.stringify(a)})).id,email:s.email,role:s.role,firstName:s.first_name,lastName:s.last_name,region:s.region,isActive:s.is_active,emailVerifiedAt:s.email_verified_at,lastLoginAt:s.last_login_at,consentNewsletter:s.consent_newsletter,consentAnalytics:s.consent_analytics,createdAt:s.created_at,updatedAt:s.updated_at}}var o=s(8358),c=s(2531);function d({user:e}){let{reloadUser:t}=(0,o.a)(),[s,i]=(0,r.useState)(e.firstName??""),[c,d]=(0,r.useState)(e.lastName??""),[u,m]=(0,r.useState)(e.region??""),p="producer"===e.role?"Producteur":"admin"===e.role?"Admin":"Consommateur",[x,g]=(0,r.useState)(!!e.consentNewsletter),[h,v]=(0,r.useState)(!!e.consentAnalytics),[f,j]=(0,r.useState)(!1),[N,y]=(0,r.useState)(null),[b,_]=(0,r.useState)(null),P=async e=>{e.preventDefault(),y(null),_(null);let a=(0,n.Z6)();if(!a){y("Veuillez vous reconnecter.");return}j(!0);try{await l(a.accessToken,{firstName:s,lastName:c,region:u,consentNewsletter:x,consentAnalytics:h}),_("Profil mis a jour.");try{await t()}catch{}}catch(e){if(e&&"object"==typeof e&&"payload"in e){let t=e.payload;if(t&&"object"==typeof t&&"detail"in t){let e=t.detail;y("string"==typeof e?e:"Mise a jour impossible.")}else y("Mise a jour impossible.")}else e instanceof Error?y(e.message):y("Mise a jour impossible.")}finally{j(!1)}};return(0,a.jsxs)("form",{className:"grid",style:{gap:"var(--space-3)"},onSubmit:P,children:[(0,a.jsxs)("div",{className:"card",style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[a.jsx("span",{className:"badge",children:p}),(0,a.jsxs)("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:["Email : ",e.email]}),(0,a.jsxs)("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:["Compte cr\xe9\xe9 le ",new Date(e.createdAt).toLocaleDateString("fr-FR")]})]}),(0,a.jsxs)("div",{className:"grid",style:{gap:"var(--space-2)",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))"},children:[(0,a.jsxs)("label",{className:"input-label",children:["Prenom",a.jsx("input",{className:"input",value:s,onChange:e=>i(e.target.value)})]}),(0,a.jsxs)("label",{className:"input-label",children:["Nom",a.jsx("input",{className:"input",value:c,onChange:e=>d(e.target.value)})]})]}),(0,a.jsxs)("label",{className:"input-label",children:["Region",a.jsx("input",{className:"input",value:u,onChange:e=>m(e.target.value),placeholder:"Occitanie, Ile-de-France, ..."})]}),(0,a.jsxs)("label",{className:"checkbox",children:[a.jsx("input",{type:"checkbox",checked:x,onChange:e=>g(e.target.checked)}),"Recevoir des nouvelles responsables (newsletter)"]}),(0,a.jsxs)("label",{className:"checkbox",children:[a.jsx("input",{type:"checkbox",checked:h,onChange:e=>v(e.target.checked)}),"Partager des donnees d'usage anonymisees (amelioration)"]}),"producer"===e.role?(0,a.jsxs)("div",{className:"alert alert--info",children:["Profil producteur : rendez-vous sur ",a.jsx("strong",{children:"Producteurs > Dashboard"})," pour g\xe9rer vos produits, commandes et recommandations IA."]}):null,"admin"===e.role?a.jsx("div",{className:"alert alert--info",children:"Profil admin : g\xe9rez les utilisateurs et rapports depuis le menu Administration."}):null,N?a.jsx("div",{className:"alert alert--warning",children:N}):null,b?a.jsx("div",{className:"alert alert--success",children:b}):null,a.jsx("div",{children:a.jsx("button",{className:"btn btn--primary",type:"submit",disabled:f,children:f?"Enregistrement...":"Enregistrer"})})]})}function u(){let{user:e}=(0,o.a)();return a.jsx("main",{className:"container",style:{display:"grid",gap:"var(--space-12)"},children:a.jsx("section",{className:"section",children:(0,a.jsxs)("div",{style:{display:"grid",gap:"var(--space-3)"},children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"badge badge--impact",children:"Mon compte"}),a.jsx("h1",{style:{marginTop:"var(--space-2)"},children:"Profil"}),a.jsx("p",{className:"muted",children:"Mettez a jour vos informations personnelles."})]}),e?a.jsx(d,{user:e}):a.jsx("p",{className:"muted",children:"Veuillez vous connecter."})]})})})}function m(){return a.jsx(c.Z,{requireAuth:!0,children:()=>a.jsx(u,{})})}},3736:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i,metadata:()=>n});var a=s(9510);let r=(0,s(8570).createProxy)(String.raw`C:\New\Greencart\Greencart\components\ProfilePage.tsx#default`),n={title:"Mon profil | GreenCart",description:"Mettez a jour vos informations personnelles et preferences."};function i(){return a.jsx(r,{})}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[948,772,404,424,526,531],()=>s(3139));module.exports=a})();