(()=>{var e={};e.id=962,e.ids=[962],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8103:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>s.a,__next_app__:()=>p,originalPathname:()=>c,pages:()=>u,routeModule:()=>m,tree:()=>o}),r(267),r(8242),r(5866);var a=r(3191),n=r(8716),i=r(7922),s=r.n(i),l=r(5231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);r.d(t,d);let o=["",{children:["admin",{children:["bi",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,267)),"C:\\New\\Greencart\\Greencart\\app\\admin\\bi\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,8242)),"C:\\New\\Greencart\\Greencart\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],u=["C:\\New\\Greencart\\Greencart\\app\\admin\\bi\\page.tsx"],c="/admin/bi/page",p={require:r,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/admin/bi/page",pathname:"/admin/bi",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},8404:(e,t,r)=>{Promise.resolve().then(r.bind(r,822))},822:(e,t,r)=>{"use strict";r.d(t,{default:()=>u});var a=r(326),n=r(2531),i=r(7577),s=r(3391),l=r(6824);async function d(e,t){let r={region:t.region||void 0,producer_id:t.producerId,date_start:t.dateStart||void 0,date_end:t.dateEnd||void 0},a=await (0,l.S)("/analytics/embed-token",{method:"POST",authToken:e,body:JSON.stringify(r)});return{embedUrl:a.embed_url,token:a.token,expiresAt:a.expires_at}}function o({title:e="Tableau de bord Power BI"}){let[t,r]=(0,i.useState)({}),[n,l]=(0,i.useState)(null),[o,u]=(0,i.useState)(null),[c,p]=(0,i.useState)(!1),m=(0,i.useMemo)(()=>(function(e){if(!e)return null;try{let t=new URL(e.embedUrl);return e.token&&t.searchParams.set("access_token",e.token),t.toString()}catch{return e.embedUrl}})(n),[n]),x=async()=>{let e=(0,s.Z6)();if(!e){u("Authentification requise.");return}p(!0),u(null);try{let r=await d(e.accessToken,t);l(r)}catch(e){console.error("[AdminAnalyticsEmbed] Failed to fetch embed token",e),u("Impossible de r\xe9cup\xe9rer le tableau de bord externe."),l(null)}finally{p(!1)}};return a.jsx("section",{className:"section",children:(0,a.jsxs)("div",{className:"grid",style:{gap:"var(--space-4)"},children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"badge badge--impact",children:"BI externe"}),a.jsx("h2",{style:{marginTop:"var(--space-1)"},children:e}),a.jsx("p",{className:"muted",style:{margin:0},children:"Tableau de bord Power BI avec filtres r\xe9gion / producteur / p\xe9riode."})]}),(0,a.jsxs)("div",{className:"card",style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[a.jsx("input",{className:"input",placeholder:"R\xe9gion (optionnel)",value:t.region??"",style:{flex:"1 1 180px",minWidth:160},onChange:e=>r(t=>({...t,region:e.target.value||void 0}))}),a.jsx("input",{className:"input",type:"number",placeholder:"Producteur ID",value:t.producerId??"",style:{flex:"1 1 150px",minWidth:140},onChange:e=>r(t=>({...t,producerId:e.target.value?Number(e.target.value):void 0}))}),a.jsx("input",{className:"input",type:"date",value:t.dateStart??"",style:{flex:"1 1 150px",minWidth:140},onChange:e=>r(t=>({...t,dateStart:e.target.value||void 0}))}),a.jsx("input",{className:"input",type:"date",value:t.dateEnd??"",style:{flex:"1 1 150px",minWidth:140},onChange:e=>r(t=>({...t,dateEnd:e.target.value||void 0}))}),a.jsx("button",{className:"btn btn--primary",type:"button",onClick:x,disabled:c,children:c?"Chargement...":"Charger le tableau"}),n?(0,a.jsxs)("div",{className:"muted",style:{marginLeft:"auto",fontSize:"var(--fs-small)"},children:["Expire le ",new Date(n.expiresAt).toLocaleString("fr-FR")]}):null]}),o?a.jsx("div",{className:"alert alert--warning",children:o}):null,a.jsx("div",{className:"card",style:{minHeight:360,height:"60vh",display:"grid"},children:m?a.jsx("iframe",{title:"Power BI dashboard",src:m,style:{width:"100%",height:"100%",minHeight:360,border:"none"},allowFullScreen:!0}):a.jsx("p",{className:"muted",style:{margin:0},children:c?"Chargement du tableau...":"Cliquez sur Charger pour afficher le tableau Power BI."})})]})})}function u(){return a.jsx(n.Z,{requireAuth:!0,requiredRole:"admin",children:()=>a.jsx(o,{title:"Tableau Power BI"})})}},267:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s,metadata:()=>i});var a=r(9510);let n=(0,r(8570).createProxy)(String.raw`C:\New\Greencart\Greencart\components\AdminBiPage.tsx#default`),i={title:"Admin - Tableau Power BI | GreenCart",description:"Tableau de bord externe (Power BI) avec filtres."};function s(){return a.jsx(n,{})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,772,404,424,526,531],()=>r(8103));module.exports=a})();