(()=>{var e={};e.id=282,e.ids=[282],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9823:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>c,routeModule:()=>m,tree:()=>o}),a(4188),a(8242),a(5866);var s=a(3191),r=a(8716),n=a(7922),i=a.n(n),l=a(5231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);a.d(t,d);let o=["",{children:["admin",{children:["public-data",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,4188)),"C:\\New\\Greencart\\Greencart\\app\\admin\\public-data\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,8242)),"C:\\New\\Greencart\\Greencart\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\New\\Greencart\\Greencart\\app\\admin\\public-data\\page.tsx"],p="/admin/public-data/page",u={require:a,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/admin/public-data/page",pathname:"/admin/public-data",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},605:(e,t,a)=>{Promise.resolve().then(a.bind(a,6082))},6082:(e,t,a)=>{"use strict";a.d(t,{default:()=>m});var s=a(326),r=a(7577),n=a(434),i=a(3391),l=a(8358);async function d(e,t,a){let s=new FormData;s.append("file",a);let r=await fetch(new URL(`/api/v1/admin/public-data/${encodeURIComponent(t)}/upload`,"http://localhost:8000"),{method:"POST",headers:{Authorization:`Bearer ${e}`},body:s});if(!r.ok)throw Error("Upload failed");let n=await r.json();return{dataset:n.dataset,path:n.path,exists:n.exists,sizeBytes:n.size_bytes,updatedAt:n.updated_at,count:n.count,sample:n.sample}}a(6824);var o=a(2531);let c={producers:"Producteurs locaux",consumption:"Habitudes de consommation",waste:"Gaspillage / acteurs anti-gaspi"};function p({dataset:e,onUpload:t}){let a=c[e.dataset]??e.dataset,r=e.updatedAt?new Date(1e3*e.updatedAt):null;return(0,s.jsxs)("div",{className:"card",style:{display:"grid",gap:8},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,flexWrap:"wrap"},children:[(0,s.jsxs)("div",{children:[s.jsx("strong",{children:a}),s.jsx("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:e.dataset})]}),s.jsx("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:e.exists?(0,s.jsxs)(s.Fragment,{children:[e.count," entr\xe9es • ",function(e){if(!e)return"0 o";let t=["o","Ko","Mo","Go"],a=Math.min(t.length-1,Math.floor(Math.log(e)/Math.log(1024)));return`${(e/Math.pow(1024,a)).toFixed(1)} ${t[a]}`}(e.sizeBytes)," • ",r?`MAJ ${r.toLocaleDateString("fr-FR")}`:"date inconnue"]}):"Aucune donn\xe9e import\xe9e"}),(0,s.jsxs)("label",{className:"btn btn--ghost",style:{marginLeft:"auto"},children:["Importer un CSV",s.jsx("input",{type:"file",accept:".csv,text/csv",style:{display:"none"},onChange:async e=>{let a=e.target.files?.[0];a&&(await t(a),e.target.value="")}})]})]}),e.sample&&e.sample.length>0?s.jsx("div",{style:{overflowX:"auto"},children:(0,s.jsxs)("table",{className:"table",style:{minWidth:480},children:[s.jsx("thead",{children:s.jsx("tr",{children:Object.keys(e.sample[0]).slice(0,4).map(e=>s.jsx("th",{children:e},e))})}),s.jsx("tbody",{children:e.sample.map((t,a)=>s.jsx("tr",{children:Object.keys(e.sample[0]).slice(0,4).map(e=>s.jsx("td",{children:String(t[e]??"")},e))},a))})]})}):s.jsx("p",{className:"muted",style:{margin:0},children:"Pas encore d’\xe9chantillon pour ce jeu."}),"producers"===e.dataset?(0,s.jsxs)("div",{className:"alert alert--info",style:{margin:0},children:["Endpoint public disponible : ",s.jsx("code",{children:"/api/v1/public/producers"})," (utilisable c\xf4t\xe9 front pour cartes/filters)."]}):null]})}function u(){let[e,t]=(0,r.useState)([]),[a,o]=(0,r.useState)(null),[c,u]=(0,r.useState)(!1),{user:m}=(0,l.a)(),h=e=>async a=>{let s=(0,i.Z6)();if(s){u(!0),o(null);try{let r=await d(s.accessToken,e,a);t(t=>[...t.filter(t=>t.dataset!==e),r].sort((e,t)=>e.dataset.localeCompare(t.dataset)))}catch(e){console.error(e),o("Import impossible. V\xe9rifiez le CSV.")}finally{u(!1)}}},x=(0,r.useMemo)(()=>e.slice().sort((e,t)=>e.dataset.localeCompare(t.dataset)),[e]);return(0,s.jsxs)("main",{className:"container",style:{display:"grid",gap:"var(--space-12)"},children:[(0,s.jsxs)("nav",{"aria-label":"Fil d'ariane",style:{fontSize:"var(--fs-small)"},children:[s.jsx(n.default,{className:"muted",href:"/",children:"Accueil"})," / Admin / Donn\xe9es publiques"]}),s.jsx("section",{className:"section",children:(0,s.jsxs)("div",{className:"grid",style:{gap:"var(--space-3)"},children:[(0,s.jsxs)("div",{children:[s.jsx("div",{className:"badge badge--impact",children:"Administration"}),s.jsx("h1",{style:{marginTop:"var(--space-2)"},children:"Donn\xe9es publiques"}),s.jsx("p",{className:"muted",children:"Import CSV, pr\xe9visualisation et publication d’API publiques pour les jeux producteurs/conso/gaspillage."})]}),a?s.jsx("div",{className:"alert alert--warning",children:a}):null,c?s.jsx("p",{className:"muted",children:"Chargement..."}):null,s.jsx("div",{className:"grid",style:{gap:"var(--space-3)"},children:x.map(e=>s.jsx(p,{dataset:e,onUpload:h(e.dataset)},e.dataset))}),(0,s.jsxs)("div",{className:"alert alert--info",children:["Tips : utilisez ces donn\xe9es pour alimenter les filtres r\xe9gion/“R\xe9seau de producteurs” sur le front. Endpoint public actuel : ",s.jsx("code",{children:"/api/v1/public/producers"}),"."]})]})})]})}function m(){return s.jsx(o.Z,{requireAuth:!0,requiredRole:"admin",children:()=>s.jsx(u,{})})}},4188:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i,metadata:()=>n});var s=a(9510);let r=(0,a(8570).createProxy)(String.raw`C:\New\Greencart\Greencart\components\AdminPublicDataPage.tsx#default`),n={title:"Admin - Donn\xe9es publiques | GreenCart",description:"Import et pr\xe9visualisation des donn\xe9es publiques (producteurs, consommation, gaspillage)."};function i(){return s.jsx(r,{})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[948,772,404,424,526,531],()=>a(9823));module.exports=s})();