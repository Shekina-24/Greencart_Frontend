(()=>{var e={};e.id=668,e.ids=[668],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},920:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>o,routeModule:()=>m,tree:()=>c}),s(2130),s(8242),s(5866);var a=s(3191),n=s(8716),r=s(7922),i=s.n(r),l=s(5231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);s.d(t,d);let c=["",{children:["admin",{children:["analytics",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,2130)),"C:\\New\\Greencart\\Greencart\\app\\admin\\analytics\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,8242)),"C:\\New\\Greencart\\Greencart\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],o=["C:\\New\\Greencart\\Greencart\\app\\admin\\analytics\\page.tsx"],u="/admin/analytics/page",p={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/admin/analytics/page",pathname:"/admin/analytics",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},4575:(e,t,s)=>{Promise.resolve().then(s.bind(s,759))},759:(e,t,s)=>{"use strict";s.d(t,{default:()=>u});var a=s(326),n=s(7577),r=s(434),i=s(3391),l=s(6824),d=s(2531);function c({value:e,max:t,label:s}){let n=t>0?Math.min(100,Math.round(e/t*100)):0;return(0,a.jsxs)("div",{style:{display:"grid",gap:4},children:[a.jsx("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:s}),a.jsx("div",{style:{background:"#eee",height:8,borderRadius:4},children:a.jsx("div",{style:{width:`${n}%`,height:8,background:"var(--primary-500, #22a)",borderRadius:4}})}),a.jsx("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:e})]})}function o(){let[e,t]=(0,n.useState)(null),[s,d]=(0,n.useState)(null),[o,u]=(0,n.useState)(null),[p,m]=(0,n.useState)(!1),[x,h]=(0,n.useState)(""),[g,v]=(0,n.useState)(""),[y,j]=(0,n.useState)("day"),f=async()=>{let e=(0,i.Z6)();if(e){m(!0),u(null);try{let[s,a]=await Promise.all([(0,l.S)("/admin/reports/summary",{authToken:e.accessToken,params:{period_start:x||void 0,period_end:g||void 0}}),(0,l.S)("/analytics/timeseries",{authToken:e.accessToken,params:{period_start:x||void 0,period_end:g||void 0,granularity:y}})]);t(s),d(a)}catch(e){u("Impossible de charger les analytics.")}finally{m(!1)}}},b=Math.max(0,...s?.points.map(e=>e.orders)??[0]),S=Math.max(0,...s?.points.map(e=>e.revenue_cents)??[0]);return(0,a.jsxs)("main",{className:"container",style:{display:"grid",gap:"var(--space-12)"},children:[(0,a.jsxs)("nav",{"aria-label":"Fil d'ariane",style:{fontSize:"var(--fs-small)"},children:[a.jsx(r.default,{className:"muted",href:"/",children:"Accueil"})," / Admin / Analytics"]}),a.jsx("section",{className:"section",children:(0,a.jsxs)("div",{style:{display:"grid",gap:"var(--space-3)"},children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"badge badge--impact",children:"Administration"}),a.jsx("h1",{style:{marginTop:"var(--space-2)"},children:"Analytics"}),a.jsx("p",{className:"muted",children:"Series temporelles, top produits et panier moyen."})]}),o?a.jsx("div",{className:"alert alert--warning",children:o}):null,(0,a.jsxs)("div",{className:"card",style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[a.jsx("input",{className:"input",type:"date",value:x,onChange:e=>h(e.target.value)}),a.jsx("input",{className:"input",type:"date",value:g,onChange:e=>v(e.target.value)}),(0,a.jsxs)("select",{className:"select",value:y,onChange:e=>j(e.target.value),children:[a.jsx("option",{value:"day",children:"Jour"}),a.jsx("option",{value:"week",children:"Semaine"}),a.jsx("option",{value:"month",children:"Mois"})]}),a.jsx("button",{className:"btn btn--primary",type:"button",onClick:f,children:"Actualiser"}),(0,a.jsxs)("div",{style:{marginLeft:"auto",display:"flex",gap:8,flexWrap:"wrap"},children:[a.jsx("button",{className:"btn btn--ghost",type:"button",onClick:()=>{let e=new Date,t=new Date(e);t.setDate(e.getDate()-30),h(t.toISOString().slice(0,10)),v(e.toISOString().slice(0,10)),j("day")},children:"30j"}),a.jsx("button",{className:"btn btn--ghost",type:"button",onClick:()=>{let e=new Date,t=new Date(e);t.setDate(e.getDate()-90),h(t.toISOString().slice(0,10)),v(e.toISOString().slice(0,10)),j("week")},children:"90j"}),a.jsx("button",{className:"btn btn--ghost",type:"button",onClick:()=>{let e=new Date;h(new Date(Date.UTC(e.getFullYear(),0,1)).toISOString().slice(0,10)),v(e.toISOString().slice(0,10)),j("month")},children:"YTD"}),a.jsx("button",{className:"btn btn--ghost",type:"button",onClick:()=>{let e=new Date,t=new Date(e);t.setFullYear(e.getFullYear()-1),h(t.toISOString().slice(0,10)),v(e.toISOString().slice(0,10)),j("month")},children:"12m"})]})]}),p?a.jsx("p",{className:"muted",children:"Chargement..."}):(0,a.jsxs)(a.Fragment,{children:[e?(0,a.jsxs)("div",{className:"card",style:{display:"grid",gap:8},children:[a.jsx("strong",{children:"Periode"}),a.jsx("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:`${new Date(e.period_start).toLocaleDateString("fr-FR")} -> ${new Date(e.period_end).toLocaleDateString("fr-FR")}`}),(0,a.jsxs)("div",{style:{display:"grid",gap:4,gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))"},children:[(0,a.jsxs)("div",{children:["Total commandes: ",e.total_orders]}),(0,a.jsxs)("div",{children:["Revenu total (centimes): ",e.total_revenue_cents]}),(0,a.jsxs)("div",{children:["Articles vendus: ",e.total_items_sold]}),(0,a.jsxs)("div",{children:["Panier moyen (centimes): ",e.average_order_value_cents]})]})]}):null,s?(0,a.jsxs)("div",{className:"card",style:{display:"grid",gap:12},children:[a.jsx("strong",{children:"Series temporelles (jour)"}),a.jsx("div",{style:{display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))"},children:s.points.map(e=>(0,a.jsxs)("div",{className:"grid",style:{gap:8},children:[a.jsx("div",{className:"muted",style:{fontSize:"var(--fs-small)"},children:e.bucket}),a.jsx(c,{value:e.orders,max:b,label:"Commandes"}),a.jsx(c,{value:e.revenue_cents,max:S,label:"Revenu (c)"})]},e.bucket))})]}):null,e?(0,a.jsxs)("div",{className:"card",style:{display:"grid",gap:8},children:[a.jsx("strong",{children:"Top produits"}),0===e.top_products.length?a.jsx("p",{className:"muted",children:"Aucun produit."}):a.jsx("div",{className:"grid",style:{gap:8},children:e.top_products.map((e,t)=>(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[a.jsx("span",{children:e.product_title||`Produit #${e.product_id??"N/A"}`}),(0,a.jsxs)("span",{className:"muted",style:{fontSize:"var(--fs-small)"},children:[e.units," u. â€¢ ",e.revenue_cents," c"]})]},`${e.product_id}-${t}`))})]}):null]})]})})]})}function u(){return a.jsx(d.Z,{requireAuth:!0,requiredRole:"admin",children:()=>a.jsx(o,{})})}},2130:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i,metadata:()=>r});var a=s(9510);let n=(0,s(8570).createProxy)(String.raw`C:\New\Greencart\Greencart\components\AdminAnalyticsPage.tsx#default`),r={title:"Admin \xb7 Analytics | GreenCart",description:"Suivi des ventes et s\xe9ries temporelles."};function i(){return a.jsx(n,{})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[948,772,404,424,526,531],()=>s(920));module.exports=a})();