(()=>{var e={};e.id=105,e.ids=[105],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8708:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>o,routeModule:()=>h,tree:()=>d}),s(5565),s(8242),s(5866);var a=s(3191),i=s(8716),r=s(7922),n=s.n(r),l=s(5231),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);s.d(t,c);let d=["",{children:["admin",{children:["utilisateurs",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,5565)),"C:\\New\\Greencart\\Greencart\\app\\admin\\utilisateurs\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,8242)),"C:\\New\\Greencart\\Greencart\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],o=["C:\\New\\Greencart\\Greencart\\app\\admin\\utilisateurs\\page.tsx"],u="/admin/utilisateurs/page",m={require:s,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/admin/utilisateurs/page",pathname:"/admin/utilisateurs",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},1837:(e,t,s)=>{Promise.resolve().then(s.bind(s,9331))},9331:(e,t,s)=>{"use strict";s.d(t,{default:()=>j});var a=s(326),i=s(7577),r=s(434),n=s(3391),l=s(6824),c=s(2531),d=s(8358);async function o(e,t,s){return(0,l.S)(`/admin/users/${t}/role`,{method:"PATCH",authToken:e,body:JSON.stringify({role:s})})}async function u(e,t,s){return(0,l.S)(`/admin/users/${t}/status`,{method:"PATCH",authToken:e,body:JSON.stringify({is_active:s})})}async function m(e,t){return(0,l.S)("/admin/users",{method:"POST",authToken:e,body:JSON.stringify(t)})}async function h(e,t){await (0,l.S)(`/admin/users/${t}`,{method:"DELETE",authToken:e})}function p({value:e,onChange:t}){return(0,a.jsxs)("select",{className:"select",value:e,onChange:e=>t(e.target.value),children:[a.jsx("option",{value:"consumer",children:"Consommateur"}),a.jsx("option",{value:"producer",children:"Producteur"}),a.jsx("option",{value:"admin",children:"Admin"})]})}function x(){let[e,t]=(0,i.useState)([]),[s,l]=(0,i.useState)(!1),[c,x]=(0,i.useState)(null),[j,g]=(0,i.useState)(""),[y,f]=(0,i.useState)(""),[v,b]=(0,i.useState)("consumer"),{user:N}=(0,d.a)(),C=async(e,s)=>{try{let a=(0,n.Z6)();if(!a)return;let i=await o(a.accessToken,e,s);t(e=>e.map(e=>e.id===i.id?{...e,role:i.role}:e))}catch{}},_=async(e,s)=>{try{let a=(0,n.Z6)();if(!a)return;let i=await u(a.accessToken,e,s);t(e=>e.map(e=>e.id===i.id?{...e,is_active:i.is_active}:e))}catch{}},P=async e=>{e.preventDefault();let s=(0,n.Z6)();if(s){x(null);try{let e=await m(s.accessToken,{email:j,password:y,role:v});t(t=>[e,...t]),g(""),f(""),b("consumer")}catch(e){x("Cr\xe9ation impossible (email d\xe9j\xe0 utilis\xe9 ?)")}}},S=async e=>{let s=(0,n.Z6)();if(s)try{await h(s.accessToken,e),t(t=>t.filter(t=>t.id!==e))}catch{}},w=(0,i.useMemo)(()=>e.length,[e]);return(0,a.jsxs)("main",{className:"container",style:{display:"grid",gap:"var(--space-12)"},children:[(0,a.jsxs)("nav",{"aria-label":"Fil d'ariane",style:{fontSize:"var(--fs-small)"},children:[a.jsx(r.default,{className:"muted",href:"/",children:"Accueil"})," / Admin / Utilisateurs"]}),a.jsx("section",{className:"section",children:(0,a.jsxs)("div",{style:{display:"grid",gap:"var(--space-3)"},children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"badge badge--impact",children:"Administration"}),a.jsx("h1",{style:{marginTop:"var(--space-2)"},children:"Utilisateurs"}),(0,a.jsxs)("p",{className:"muted",children:["Cr\xe9ation, activation et gestion des r\xf4les (",w,")."]})]}),(0,a.jsxs)("div",{className:"card",style:{display:"grid",gap:8},children:[a.jsx("strong",{children:"Cr\xe9er un utilisateur"}),(0,a.jsxs)("form",{className:"grid",style:{gap:8,gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))"},onSubmit:P,children:[(0,a.jsxs)("label",{className:"input-label",children:["Email",a.jsx("input",{className:"input",type:"email",required:!0,value:j,onChange:e=>g(e.target.value)})]}),(0,a.jsxs)("label",{className:"input-label",children:["Mot de passe",a.jsx("input",{className:"input",type:"password",required:!0,value:y,onChange:e=>f(e.target.value)})]}),(0,a.jsxs)("label",{className:"input-label",children:["R\xf4le",a.jsx(p,{value:v,onChange:b})]}),a.jsx("div",{style:{alignSelf:"end"},children:a.jsx("button",{className:"btn btn--primary",type:"submit",children:"Cr\xe9er"})})]})]}),c?a.jsx("div",{className:"alert alert--warning",children:c}):null,s?a.jsx("p",{className:"muted",children:"Chargement..."}):0===e.length?a.jsx("p",{className:"muted",children:"Aucun utilisateur."}):a.jsx("div",{className:"card",style:{overflowX:"auto"},children:(0,a.jsxs)("table",{className:"table",style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"ID"}),a.jsx("th",{children:"Email"}),a.jsx("th",{children:"R\xf4le"}),a.jsx("th",{children:"Nom"}),a.jsx("th",{children:"R\xe9gion"}),a.jsx("th",{children:"Cr\xe9\xe9"}),a.jsx("th",{children:"Actif"}),a.jsx("th",{children:"Actions"})]})}),a.jsx("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{children:[a.jsx("td",{children:e.id}),a.jsx("td",{children:e.email}),a.jsx("td",{children:a.jsx(p,{value:e.role,onChange:t=>C(e.id,t)})}),a.jsx("td",{children:e.first_name||e.last_name?`${e.first_name??""} ${e.last_name??""}`.trim():"—"}),a.jsx("td",{children:e.region??"—"}),a.jsx("td",{children:new Date(e.created_at).toLocaleString("fr-FR")}),a.jsx("td",{children:(0,a.jsxs)("label",{className:"checkbox",children:[a.jsx("input",{type:"checkbox",checked:e.is_active,onChange:t=>_(e.id,t.target.checked),disabled:N?.id===e.id}),a.jsx("span",{className:"muted",style:{fontSize:"var(--fs-small)"},children:e.is_active?"Actif":"Inactif"})]})}),a.jsx("td",{children:(0,a.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[a.jsx("button",{className:"btn btn--ghost",type:"button",onClick:()=>C(e.id,"consumer"===e.role?"producer":"consumer"),children:"Basculer C/P"}),a.jsx("button",{className:"btn btn--ghost",type:"button",onClick:()=>S(e.id),disabled:N?.id===e.id,children:"Supprimer"})]})})]},e.id))})]})})]})})]})}function j(){return a.jsx(c.Z,{requireAuth:!0,requiredRole:"admin",children:()=>a.jsx(x,{})})}},5565:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n,metadata:()=>r});var a=s(9510);let i=(0,s(8570).createProxy)(String.raw`C:\New\Greencart\Greencart\components\AdminUsersPage.tsx#default`),r={title:"Admin \xb7 Utilisateurs | GreenCart",description:"Gestion des utilisateurs et r\xf4les."};function n(){return a.jsx(i,{})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[948,772,404,424,526,531],()=>s(8708));module.exports=a})();